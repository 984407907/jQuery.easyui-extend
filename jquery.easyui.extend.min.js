/**
 * Licensed under the GPL licenses
 * http://www.gnu.org/licenses/gpl.txt
 *
 * @author: 爱看书不识字<zjh527@163.com>
 * @date: 2013-7-31
 * https://github.com/loafer/jQuery.easyui-extend
 * http://blog.csdn.net/zjh527
 */
(function(d){function a(g){var h=d.extend(true,{},d.fn.combobox.defaults,d(g).combobox("options"));var f=h.customAttr.slave;if(f.id==null){return}if(/^#/.test(f.id)){f.id=f.id}else{f.id="#"+f.id}if(!h.multiple&&!h.editable){d(g).combobox("addEventListener",[{name:"onSelect",handler:function(j){b(g,f,j)}},{name:"onChange",handler:function(k,j){if(k==null||k==""){d(f.id).combobox("clear").combobox("loadData",[]);d(g).combobox("textbox").trigger("blur")}}}])}}function b(h,j,f){if(j.remote){var g=j.url||d(j.id).combobox("options").url;if(g.indexOf("?")>-1){g+="&swd="+d(h).combobox("getValue")}else{g+="?swd="+d(h).combobox("getValue")}d(j.id).combobox("reload",g)}else{d(j.id).combobox("loadData",f.data)}}function e(g){var h=d(g).combobox("options");var f=d.extend(true,{},d.fn.combobox.defaults,h);if(!f.customAttr.headervalue){return}d(g).combobox("addEventListener",{name:"onLoadSuccess",handler:function(){d(g).combobox("textbox").trigger("blur")}})}function c(k,f,j,h){var g=d(k).combobox("options");var l=g[f];switch(f){case"onBeforeLoad":if(h){g[f]=j}else{g[f]=function(m){l.apply(this,arguments);j.apply(this,arguments)}}break;case"onLoadSuccess":if(h){g[f]=j}else{g[f]=function(){l.apply(this,arguments);j.apply(this,arguments)}}break;case"onLoadError":if(h){g[f]=j}else{g[f]=function(){l.apply(this,arguments);j.apply(this,arguments)}}break;case"onSelect":if(h){g[f]=j}else{g[f]=function(m){l.apply(this,arguments);j.apply(this,arguments)}}break;case"onUnselect":if(h){g[f]=j}else{g[f]=function(m){l.apply(this,arguments);j.apply(this,arguments)}}break;default:d(k).combo("addEventListener",{name:f,override:h,handler:j});break}}d.fn.combobox.defaults.customAttr={slave:{id:null,remote:true,url:null}};d.extend(d.fn.combobox.methods,{followCustomHandle:function(f){return f.each(function(){e(this);a(this);d(this).combo("followCustomHandle")})},addEventListener:function(g,f){return g.each(function(){var h=d.isArray(f)?f:[f];var j=this;d.each(h,function(k,l){c(j,l.name,l.handler||function(){},l.override)})})}})})(jQuery);(function(f){function c(j){var k=f.data(j,"combo").options;var h=f.extend(true,{},f.fn.combo.defaults,k);if(!h.customAttr.headervalue){return}if(k.required){var g=['unequal["'+h.customAttr.headervalue+'"]'];if(k.validType){if(typeof k.validType=="string"){g.push(k.validType);k.validType=g}if(f.isArray(k.validType)){f.merge(k.validType,g)}}else{f.extend(k,{validType:g})}}f(j).combo("addEventListener",{name:"onChange",handler:function(m,l){if(m==null||m==""){f(j).combo("setText",h.customAttr.headervalue)}}}).combo("textbox").val(h.customAttr.headervalue).attr("prompt",h.customAttr.headervalue).focus(function(){if(f(this).val()==h.customAttr.headervalue){f(this).val("")}}).blur(function(){if(f.trim(f(this).val())==""){f(this).val(h.customAttr.headervalue)}f(j).combo("validate")})}function a(j){var h=f(j).combo("getValue");if(!h){return}var g=f.data(j,"combo").options;f(j).combo("setText","");if(g.multiple){f(j).combo("setValues",[])}else{f(j).combo("setValue","")}}function b(h){var g=f(h).combo("getValues");return g.length>0?(g[0]!=""?g[0]:null):null}function e(h){var j=f.extend(true,{},f.fn.combo.defaults,f.data(h,"combo").options);var g=j.customAttr.autocomplete;if(!g.enabled){return}f(h).combo("textbox").keyup(function(k){if(f(this).val().length!=0&&(f(this).val().length%g.minLength==0)&&g.url){f.ajax({type:"POST",url:g.url,data:{wd:f(this).val()},dataType:"json",success:function(n){var l=f(h).combo("panel").empty();for(var m=0;m<n.length;m++){f("<div>").addClass("combobox-item").attr("value",n[m].id).text(n[m].text).click(function(q){var o=f(this).attr("value");var p=f(this).text();f(h).combo("setValue",o).combo("setText",p).combo("hidePanel")}).hover(function(){f(this).addClass("combobox-item-hover")},function(){f(this).removeClass("combobox-item-hover")}).appendTo(l)}},error:function(l,n,m){f.messager.alert("Error",m,"error")}})}})}function d(l,g,k,j){var h=f(l).combo("options");var m=h[g];switch(g){case"onShowPanel":if(j){h[g]=k}else{h[g]=function(){m.apply(this,arguments);k.apply(this,arguments)}}break;case"onHidePanel":if(j){h[g]=k}else{h[g]=function(){m.apply(this,arguments);k.apply(this,arguments)}}break;case"onChange":if(j){h[g]=k}else{h[g]=function(o,n){m.apply(this,arguments);k.apply(this,arguments)}}break;default:break}}f.fn.combo.defaults.customAttr={headervalue:null,autocomplete:{enabled:false,minLength:3,url:undefined}};f.extend(f.fn.combo.methods,{followCustomHandle:function(g){return g.each(function(){c(this);e(this)})},clear:function(g){return g.each(function(){a(this)})},getValue:function(g){return b(g[0])},addEventListener:function(h,g){return h.each(function(){var j=f.isArray(g)?g:[g];var k=this;f.each(j,function(l,m){d(k,m.name,m.handler||function(){},m.override)})})}})})(jQuery);(function(c){function u(z,A,w){var y=h(z,w);var x=c("#"+y);if(x.length==0){x=c("<div>",{id:y}).menu().menu("appendItems",A)}return x}function h(x,w){return c(x).attr("id")+"_"+w}function s(x){var w={};c.each(x,function(){var z=this;if(z.onclick){var y=z.id||z.text;w[y]=z.onclick;delete z.onclick}if(z.submenu&&c.isArray(z.submenu)&&z.submenu.length>0){c.extend(w,s(z.submenu))}});return w}function m(D){var C=h(D,"headerContextMenu");var x=[{text:"显示/隐藏列",iconCls:"icon-columns",submenu:[{id:C+"_showAll",text:"全部显示",iconCls:"icon-columns",onclick:function(F,G,E){c.fn.datagrid.headerContextMenu.defaultEvents.doShowAll(E)}},{id:C+"_restore",text:"还原",iconCls:"icon-columns",onclick:function(F,G,E){c.fn.datagrid.headerContextMenu.defaultEvents.doRestore(E)}},"-"]}];var z=function(E){return E.substr(E.lastIndexOf("_")+1,E.length)};var A=[];var y=c(D).datagrid("getColumnFields",true);var B=c(D).datagrid("getColumnFields");w(B,false);function w(F,E){c.each(F,function(H,I){if(!I||I=="ck"){return true}var G=c(D).datagrid("getColumnOption",I);G._hidden=G.hidden;A.push({id:C+"_"+I,text:G.title,disabled:E,iconCls:G.hidden?"icon-unchecked":"icon-checked",onclick:function(K,J,N){var M=z(K.id);var L=c(N).datagrid("getColumnOption",M).hidden;if(!L){c.fn.datagrid.headerContextMenu.defaultEvents.doHideColumn(N,M,K)}else{c.fn.datagrid.headerContextMenu.defaultEvents.doShowColumn(N,M,K)}}})})}c.merge(x[0].submenu,A);return x}function l(z){var x=c.extend(true,{},c.fn.datagrid.defaults,c(z).datagrid("options"));var B=x.customAttr.headerContextMenu;if(!B.isShow){return}if(x.columns[0][0].checkbox){x.columns[0][0].field="ck"}var A=m(z);if(B.isMerge){c.merge(A,B.items)}if(!B.isMerge&&c.isArray(B.items)&&B.items.length>0){A=B.items}var y=s(A);var w=u(z,A,"headerContextMenu");c(z).datagrid("addEventListener",{name:"onHeaderContextMenu",handler:function(D,C){D.preventDefault();w.menu("addEventListener",[{name:"onClick",override:true,handler:function(F){var E=F.id||F.text;if(y[E]){y[E].call(this,F,C,z)}}},{name:"onShow",override:true,handler:function(){B.onShow&&B.onShow.call(this,C,z)}},{name:"onHide",override:true,handler:function(){B.onHide&&B.onHide.call(this)}}]).menu("show",{left:D.pageX,top:D.pageY})}})}function j(y){var x=h(y,"rowContextMenu");var w=[{id:x+"_delete",text:"删除",iconCls:"icon-remove",onclick:function(A,C,B,z){c.fn.datagrid.rowContextMenu.defaultEvents.doDelete(A,C,B,z)}},"-",{id:x+"_reload",text:"刷新",iconCls:"icon-reload",onclick:function(A,C,B,z){c.fn.datagrid.rowContextMenu.defaultEvents.doReload(A,C,B,z)}},{id:x+"_reload_this_page",text:"刷新当前页",onclick:function(A,C,B,z){c.fn.datagrid.rowContextMenu.defaultEvents.doReloadThisPage(A,C,B,z)}}];return w}function e(A){var x=c.extend(true,{},c.fn.datagrid.defaults,c(A).datagrid("options"));var y=x.customAttr.rowContextMenu;if(!y.isShow){return}var B=j(A);if(y.isMerge){c.merge(B,y.items)}if(!y.isMerge&&c.isArray(y.items)&&y.items.length>0){B=y.items}var z=s(B);var w=u(A,B,"rowContextMenu");c(A).datagrid("addEventListener",{name:"onRowContextMenu",handler:function(D,E,C){D.preventDefault();c(A).datagrid("selectRow",E);w.menu("addEventListener",{name:"onClick",override:true,handler:function(G){var F=G.id||G.text;if(z[F]){z[F].call(this,G,E,C,A)}}}).menu("show",{left:D.pageX,top:D.pageY})}})}function f(C){var E=c.extend(true,{},c.fn.datagrid.defaults,c(C).datagrid("options"));if(!c.isArray(E.customAttr.slaveList)){return}if(E.customAttr.slaveList.length==0){return}var D={slaveList:E.customAttr.slaveList,activeSlave:E.customAttr.activeSlave};var y=c(C);var x=[];for(var B in D.slaveList){var z={id:D.slaveList[B].id,params:{}};var A={},w;if(!D.slaveList[B].relatedfield){w=y.datagrid("options").idField;A[w]="undefined"}else{w=D.slaveList[B].relatedfield;A[D.slaveList[B].relatedfield]="undefined"}c.extend(z.params,A,D.slaveList[B].queryParams);x.push(z)}if(D.activeSlave==c.fn.datagrid.defaults.customAttr.activeSlave){y.datagrid("addEventListener",{name:"onDblClickRow",handler:function(H,G){for(var F in x){x[F].params[w]=G[w];c("#"+x[F].id).datagrid("load",x[F].params)}}})}}function p(B){var x=c.extend(true,{},c.fn.datagrid.defaults,c(B).datagrid("options"));if(!x.customAttr.rowediting){return}var C=function(D){return c(D).attr("id")+"_editor_buttons_panel"};var w=120;var z=function(H){var G=C(H);if(c("#"+G).length>0){return}var E=c(H).datagrid("getPanel");var F=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",E);F.css("position","relative");var D=c("<div>",{id:G}).addClass("dialog-button").appendTo(F).css({position:"absolute",display:"block","border-bottom":"1px solid #ddd","border-left":"1px solid #ddd","border-right":"1px solid #ddd",left:parseInt(E.width()/2)-w,"z-index":2013,display:"none",padding:"4px 5px"});c('<a href="javascript:void(0)">确定</a>').css("margin-left","0px").linkbutton({iconCls:"icon-ok"}).click(function(){var I=c(H).datagrid("getRowIndex",c(H).datagrid("getEditingRow"));c(H).datagrid("endEdit",I)}).appendTo(D);c('<a href="javascript:void(0)">取消</a>').css("margin-left","6px").linkbutton({iconCls:"icon-cancel"}).click(function(){var I=c(H).datagrid("getRowIndex",c(H).datagrid("getEditingRow"));c(H).datagrid("cancelEdit",I)}).appendTo(D)};var A=function(K,I){var D=c.data(K,"datagrid").options;var L=D.finder.getTr(K,I,"body",2);var G=L.position();var J=function(){var M=L.height(),N=L.width();var P=G.top+H.scrollTop(),O=G.left;var Q=11;if(N>H.width()){O=H.width()/2-w}else{O=N/2-w}if(G.top+(M*2+Q)>H.height()){P=P-(M+Q)}else{P=P+M}return{top:P,left:O}};var F="#"+C(K);var E=c(K).datagrid("getPanel");var H=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",E);c(F).css(J()).show()};var y=function(E){var D="#"+C(E);c(D).hide()};c(B).datagrid("addEventListener",[{name:"onLoadSuccess",handler:function(D){z(this)}},{name:"onBeforeEdit",handler:function(D,E){A(B,D)}},{name:"onAfterEdit",handler:function(D,F,E){y(B)}},{name:"onCancelEdit",handler:function(D,E){y(B)}}])}function t(y){var x=c.extend(true,{},c.fn.datagrid.defaults,c(y).datagrid("options"));if(!x.customAttr.tooltip.enable){return}var B=function(E,D){var C={position:x.customAttr.tooltip.position,trackMouse:true,onHide:function(){c(E).tooltip("destroy")},onShow:function(){if(c.isPlainObject(D)&&D.css){c(this).tooltip("tip").css(D.css)}}};c.extend(C,c.isPlainObject(D)?D:{content:D});c(E).tooltip(C).tooltip("show")};var A=function(G,D){var H=parseInt(G.attr("datagrid-row-index"));var F=c(y).datagrid("getRows")[H];var C=function(K){var J=[];var I=c.grep(c.merge(c(y).datagrid("getColumnFields",true),c(y).datagrid("getColumnFields")),function(M,L){return c.trim(M).length>0});c.each(I,function(){var L=this;var M=c(y).datagrid("getColumnOption",L).title;J.push(M+": "+K[L])});return J.join("<br>")};var E=D?D(F,H):C(F);G.mouseover(function(){B(this,E)})};var w=function(C,D){C.mouseover(function(){var I=c(this).parent().attr("datagrid-row-index");var G=c(y).datagrid("getRows")[I];var H=c(this).attr("field");var F=G[H];var E=D?D(F,H):F;B(this,E)})};var z=function(){if(x.customAttr.tooltip.target=="row"){x.finder.getTr(y,"","allbody").each(function(){var E=c(this);if(E.hasClass("datagrid-row")){A(E,x.customAttr.tooltip.formatter)}})}else{if(x.customAttr.tooltip.fields&&c.isArray(x.customAttr.tooltip.fields)){var C=c(y).datagrid("getPanel");var D=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",C);c.each(x.customAttr.tooltip.fields,function(){var E=this;w(c("td[field="+E+"]",D),x.customAttr.tooltip.formatter)})}}};c(y).datagrid("addEventListener",{name:"onLoadSuccess",handler:function(C){z()}})}function b(x){var w=c.extend(true,{},c.fn.datagrid.defaults,c(x).datagrid("options"));if(!w.pagination){return}c(x).datagrid("addEventListener",{name:"onLoadSuccess",handler:function(y){c(x).datagrid("setPagination",w.customAttr.pagination)}})}function q(y){var x=c(y).datagrid("options");var w=function(B){var A=c(y).datagrid("getPanel");if(B.rows.length==0){var C=c("div.datagrid-view2>div.datagrid-header>div.datagrid-header-inner>table",A)[0];var z=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",A);c("<div>").html("&nbsp;").width(c(C).width()).appendTo(z)}else{c("div.datagrid-view2>div.datagrid-body>div",A).remove()}};c(y).datagrid("addEventListener",[{name:"onLoadSuccess",handler:function(z){w(z)}},{name:"onLoadError",handler:function(){w({rows:[]})}}])}function o(z,y){var w=c(z).datagrid("options");var A=c(z).datagrid("getColumnFields",true);var x=w.columns[0][0];if(A.length==0&&x.checkbox){v(z,"ck",2,1)}r(z,y,true);v(z,y,2,1)}function n(B,A){var w=c(B).datagrid("options");if(!w.frozenColumns[0]){w.frozenColumns=[[]]}var z=c(B).datagrid("getColumnOption",A);w.frozenColumns[0].push(z);y(z);c(B).datagrid(w);var x=c(B).datagrid("getHeaderContextMenu").menu("findItem",z.title);c(B).datagrid("getHeaderContextMenu").menu("disableItem",x.target);function y(E){for(var D=0;D<w.columns.length;D++){for(var C=0;C<w.columns[D].length;C++){if(w.columns[D][C].field==E.field){w.columns[D].splice(C,1);return}}}}}function v(A,B,C,D){var F=c(A).datagrid("options");var E=c.data(A,"datagrid").dc;var w=null;var w=(C==1?E.header1:E.header2).find(">table>tbody>tr.datagrid-header-row>td[field="+B+"]");if(C>D){(D==1?E.header1:E.header2).find(">table>tbody>tr.datagrid-header-row").append(w)}else{(D==1?E.header1:E.header2).find(">table>tbody>tr.datagrid-header-row").children("td[field]").each(function(){if(z(B,c(this).attr("field"))){c(this).before(w);return false}})}var x=(C==1?E.body1:E.body2).find(">table>tbody>tr>td[field="+B+"]");if(C>D){c.each(x,function(G,H){F.finder.getTr(A,G,"body",D).append(H)})}else{c.each(x,function(G,H){F.finder.getTr(A,G,"body",D).children("td[field]").each(function(){if(z(B,c(this).attr("field"))){c(this).before(H);return false}})})}c(A).datagrid("fixColumnSize");function z(G,H){return y(G)<y(H)}function y(G){return c.inArray(G,c(A).datagrid("getColumnFields"))}}function r(C,B,y){var x=D(B);var A=c(C).datagrid("getColumnOption",B);c.extend(A,{index:x});var w=c(C).datagrid("getHeaderContextMenu");var z=w.menu("findItem",A.title);if(y){w.menu("disableItem",z.target)}else{w.menu("enableItem",z.target)}function D(E){return c.inArray(E,c(C).datagrid("getColumnFields"))}}function g(C,B){var y=c(B).datagrid("getHeaderContextMenu");var A=c(B).datagrid("getColumnOption",C);var x=y.menu("findItem",A.title);if(x){if(!x.disabled){w("冻结此列");z("取消冻结")}else{w("取消冻结");z("冻结此列")}}else{z("冻结此列");z("取消冻结")}function z(E){var D=y.menu("findItem",E);if(D){y.menu("disableItem",D.target)}}function w(E){var D=y.menu("findItem",E);if(D){y.menu("enableItem",D.target)}}}function d(y,x,w){if(w){o(y,x)}else{n(y,x)}}function a(x,w){r(x,w,false);v(x,w,1,2)}function k(A,w,z,y){var x=c(A).datagrid("options");var B=x[w];switch(w){case"onLoadSuccess":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onLoadError":if(y){x[w]=z}else{x[w]=function(){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onBeforeLoad":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onClickRow":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onDblClickRow":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onClickCell":if(y){x[w]=z}else{x[w]=function(E,D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onDblClickCell":if(y){x[w]=z}else{x[w]=function(E,D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onSortColumn":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onResizeColumn":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onSelect":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onUnselect":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onSelectAll":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onUnselectAll":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);handlerapply(this,arguments)}}break;case"onCheck":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onUncheck":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onCheckAll":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onUncheckAll":if(y){x[w]=z}else{x[w]=function(C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onBeforeEdit":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onAfterEdit":if(y){x[w]=z}else{x[w]=function(E,D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onCancelEdit":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onHeaderContextMenu":if(y){x[w]=z}else{x[w]=function(D,C){B.apply(this,arguments);z.apply(this,arguments)}}break;case"onRowContextMenu":if(y){x[w]=z}else{x[w]=function(D,E,C){B.apply(this,arguments);z.apply(this,arguments)}}break;default:break}}c.fn.datagrid.headerContextMenu={};c.fn.datagrid.headerContextMenu.defaultEvents={doHideColumn:function(y,x,w){c(y).datagrid("hideColumn",x);var z=c(y).datagrid("getHeaderContextMenu");z.menu("setIcon",{target:w.target,iconCls:"icon-unchecked"})},doShowColumn:function(y,x,w){c(y).datagrid("showColumn",x);var z=c(y).datagrid("getHeaderContextMenu");z.menu("setIcon",{target:w.target,iconCls:"icon-checked"})},doShowAll:function(z){var w=c(z).datagrid("getColumnFields");var A=c(z).datagrid("getHeaderContextMenu");for(i in w){c(z).datagrid("showColumn",w[i]);var x=c(z).datagrid("getColumnOption",w[i]);var y=A.menu("findItem",x.title);if(y){A.menu("setIcon",{target:y.target,iconCls:"icon-checked"})}}},doRestore:function(z){var w=c(z).datagrid("getColumnFields");var A=c(z).datagrid("getHeaderContextMenu");for(i in w){var x=c(z).datagrid("getColumnOption",w[i]);var y=A.menu("findItem",x.title);if(!x._hidden){c(z).datagrid("showColumn",w[i]);y&&A.menu("setIcon",{target:y.target,iconCls:"icon-checked"})}else{c(z).datagrid("hideColumn",w[i]);y&&A.menu("setIcon",{target:y.target,iconCls:"icon-unchecked"})}}}};c.fn.datagrid.rowContextMenu={};c.fn.datagrid.rowContextMenu.defaultEvents={doAdd:function(w,z,x,y){},doEdit:function(w,z,x,y){},doDelete:function(w,z,x,y){c.messager.confirm("疑问","您确定要删除已选中的行？",function(A){if(A){c(y).datagrid("deleteRows",c(y).datagrid("getSelections"))}})},doReload:function(w,z,x,y){c(y).datagrid("load")},doReloadThisPage:function(w,z,x,y){c(y).datagrid("reload")},doExportThisPage:function(w,z,x,y){},doExprotAll:function(w,z,x,y){}};c.extend(c.fn.datagrid.defaults.editors,{my97:{init:function(w,y){var x=c('<input type="text" class="Wdate">').appendTo(w);y=y||{};y=c.extend({},y,{readOnly:true});return x.focus(function(){WdatePicker()})},getValue:function(w){return c(w).val()},setValue:function(x,w){c(x).val(w)},resize:function(y,x){var w=c(y);if(c.boxModel==true){w.width(x-(w.outerWidth()-w.width()))}else{w.width(x)}}},datetimebox:{init:function(w,y){var x=c('<input type="text" class="easyui-datetimebox">').appendTo(w);y=y||{};y=c.extend({},y,{formatter:function(z){return c.dateFormat(new Date(z),"yyyy-MM-dd hh:mm")}});return x.datetimebox(y)},getValue:function(w){return c(w).datetimebox("getValue")},setValue:function(x,w){c(x).datetimebox("setValue",w)},resize:function(x,w){c(x).datetimebox("resize",w)}},numberspinner:{init:function(w,y){var x=c('<input type="text">').appendTo(w);y=y||{};y=c.extend({},y,{min:0,editable:false});return x.numberspinner(y)},getValue:function(w){return c(w).numberspinner("getValue")},setValue:function(x,w){c(x).numberspinner("setValue",w)},resize:function(x,w){c(x).numberspinner("resize",w)}},timespinner:{init:function(w,y){var x=c('<input type="text">').appendTo(w);y=y||{};return x.timespinner(y)},getValue:function(w){return c(w).timespinner("getValue")},setValue:function(x,w){c(x).timespinner("setValue",w)},resize:function(x,w){c(x).timespinner("resize",w)}},combogrid:{init:function(w,y){var x=c('<input type="text">').appendTo(w);y=y||{};y=c.extend({},y,{panelWidth:400,editable:false});return x.combogrid(y)},getValue:function(w){return c(w).combogrid("getValue")},setValue:function(x,w){c(x).combogrid("setValue",w)},resize:function(x,w){c(x).combogrid("resize",w)}}});c.fn.datagrid.defaults.customAttr={headerContextMenu:{isShow:false,isMerge:true,items:[],onShow:function(x,w){},onHide:function(){}},rowContextMenu:{isShow:false,isMerge:true,items:[]},pagination:{showPageList:false,showRefresh:true,beforePageText:undefined,afterPageText:undefined,displayMsg:undefined},slaveList:undefined,activeSlave:"dblclickrow",rowediting:false,tooltip:{enable:false,target:"row",position:"bottom",fields:undefined,formatter:undefined}};c.extend(c.fn.datagrid.methods,{followCustomHandle:function(w){return w.each(function(){q(this);l(this);e(this);b(this);f(this);p(this);t(this)})},getHeaderContextMenu:function(w){return c("#"+h(w[0],"headerContextMenu"))},getRowContextMenu:function(w){return c("#"+h(w[0],"rowContextMenu"))},getEditingRow:function(A){var w=c.data(A[0],"datagrid");var y=w.options;var z=w.data;var x=[];y.finder.getTr(A[0],"","allbody").each(function(){if(c(this).hasClass("datagrid-row-editing")){var B=parseInt(c(this).attr("datagrid-row-index"));x.push(z.rows[B])}});return x.length>0?x[0]:null},setPagination:function(x,w){return x.each(function(){c(this).datagrid("getPager").pagination(w)})},deleteRows:function(x,w){return x.each(function(){var z=undefined;if(!c.isArray(w)){z=[w]}else{z=w}var y=this;c.each(z,function(B,C){if(c.isPlainObject(C)){var A=c(y).datagrid("getRowIndex",C);c(y).datagrid("deleteRow",A)}else{c(y).datagrid("deleteRow",C)}})})},freezeColumn:function(x,w){return x.each(function(){d(this,w,true)})},unfreezColumn:function(x,w){return x.each(function(){a(this,w)})},addEventListener:function(x,w){return x.each(function(){var y=c.isArray(w)?w:[w];var z=this;c.each(y,function(A,B){k(z,B.name,B.handler||function(){},B.override)})})}})})(jQuery);(function(a){a.extend({dateFormat:function(c,k){if(c==null){return null}if(k==null){var p="yyyy-MM-dd"}else{var p=k}var l=c.getFullYear().toString();var j=(c.getMonth()+1).toString();var m=c.getDate().toString();var n=c.getHours().toString();var e=c.getMinutes().toString();var o=c.getSeconds().toString();var d=p.replace(/[^y]/g,"");var q=p.replace(/[^M]/g,"");var b=p.replace(/[^d]/g,"");var g=p.replace(/[^h]/g,"");var f=p.replace(/[^m]/g,"");var h=p.replace(/[^s]/g,"");if(d.length==2){l=l.substring(2,4)}if(q.length>1&&j.length==1){j="0"+j}if(b.length>1&&m.length==1){m="0"+m}if(g.length>1&&n.length==1){n="0"+n}if(f.length>1&&e.length==1){e="0"+e}if(h.length>1&&o.length==1){o="0"+o}if(d.length>0){p=p.replace(d,l)}if(q.length>0){p=p.replace(q,j)}if(b.length>0){p=p.replace(b,m)}if(g.length>0){p=p.replace(g,n)}if(f.length>0){p=p.replace(f,e)}if(h.length>0){p=p.replace(h,o)}return p},parseDate:function(u,p){var t=new Date();if(u==null){return t}if(p==null){var m="yyyy-MM-dd"}else{var m=p}var w=m.replace(/[^y]/g,"");var l=m.replace(/[^M]/g,"");var h=m.replace(/[^d]/g,"");var x=m.replace(/[^h]/g,"");var d=m.replace(/[^m]/g,"");var f=m.replace(/[^s]/g,"");var j=m.indexOf(w);var q=w.length;var e=parseInt(u.substring(j,j+q));if(isNaN(e)){e=t.getYear()}else{if(q==2){if(e<50){e+=2000}else{e+=1900}}}var y=m.indexOf(l);var v=parseInt(u.substring(y,y+l.length));if(isNaN(v)){v=t.getMonth()}else{v-=1}var b=m.indexOf(h);var n=parseInt(u.substring(b,b+h.length));if(isNaN(n)){n=t.getDate()}var s=m.indexOf(x);var o=parseInt(u.substring(s,s+x.length));if(isNaN(o)){o=0}var c=m.indexOf(d);var k=parseInt(u.substring(c,c+d.length));if(isNaN(k)){k=0}var r=m.indexOf(f);var g=parseInt(u.substring(r,r+f.length));if(isNaN(g)){g=0}return new Date(e,v,n,o,k,g)}})})(jQuery);(function(c){function a(f,e,d){if(e&&c.isArray(e)){c.each(e,function(){var j=this;var h={};if(d){c.extend(h,{parent:d})}if(c.isPlainObject(j)){c(f).menu("appendItem",c.extend(j,h));if(j.submenu){var k=c(f).menu("findItem",j.text);a(f,j.submenu,k.target)}}else{if(j=="-"){var g=c(f).menu("appendItem",c.extend({text:j},h)).menu("findItem",j).target;c(g).removeClass("menu-item").addClass("menu-sep").removeAttr("style").empty()}}})}}function b(h,d,g,f){var e=c(h).menu("options");var j=e[d];switch(d){case"onShow":if(f){e[d]=g}else{e[d]=function(){j.apply(this,arguments);g.apply(this,arguments)}}break;case"onHide":if(f){e[d]=g}else{e[d]=function(){j.apply(this,arguments);g.apply(this,arguments)}}break;case"onClick":if(f){e[d]=g}else{e[d]=function(k){j.apply(this,arguments);g.apply(this,arguments)}}break;default:break}}c.extend(c.fn.menu.methods,{followCustomHandle:function(d){},appendItems:function(e,d){return e.each(function(){a(this,d)})},addEventListener:function(e,d){return e.each(function(){var f=c.isArray(d)?d:[d];var g=this;c.each(f,function(h,j){b(g,j.name,j.handler||function(){},j.override)})})}})})(jQuery);(function(b){function c(h){var f=b.extend(true,{},b.fn.panel.defaults,b(h).panel("options"));var g=f.customAttr.toolbar;if(!g){return}var d=b(h).panel("body");if(typeof g=="string"){b(g).addClass("dialog-toolbar panel-body").insertBefore(d);b(g).show()}else{var e=b("<div></div>").insertBefore(d);e.toolbar(g)}}function a(h,d,g,f){var e=b(h).panel("options");var j=e[d];switch(d){case"onResize":if(f){e[d]=g}else{e[d]=function(l,k){j.apply(this,arguments);g.apply(this,arguments)}}break;case"onMove":if(f){e[d]=g}else{e[d]=function(l,k){j.apply(this,arguments);g.apply(this,arguments)}}break;default:if(f){e[d]=g}else{e[d]=function(){j.apply(this,arguments);g.apply(this,arguments)}}}}b.fn.panel.defaults.customAttr={toolbar:{buttonPosition:"left",data:undefined}};b.extend(b.fn.panel.methods,{followCustomHandle:function(d){return d.each(function(){c(this)})},addEventListener:function(e,d){return e.each(function(){var f=b.isArray(d)?d:[d];var g=this;b.each(f,function(h,j){a(g,j.name,j.handler||function(){},j.override)})})}})})(jQuery);(function(a){var b=function(d,h){var e=d;var n=h;if(e<1){e=1}if(n<1){n=1}var c=parseInt(a(this).parent().css("width"))+14;var k=parseInt(a(this).parent().css("height"))+14;var j=e+c;var g=n+k;var m=a(window).width();var f=a(window).height();if(j>m){e=m-c}if(g>f){n=f-k}a(this).parent().css({left:e,top:n})};a.fn.dialog.defaults.onMove=b;a.fn.window.defaults.onMove=b;a.fn.panel.defaults.onMove=b;a.fn.panel.defaults=jQuery.extend({},a.fn.panel.defaults,{onBeforeDestroy:function(){var c=a("iframe",this);if(c.length>0){c[0].contentWindow.document.write("");c[0].contentWindow.close();c.remove()}}})})(jQuery);(function(f){function g(o){return f(o).attr("id")+"_contextmenu"}function h(q,r){var p=g(q);var o=f("#"+p);if(o.length==0){o=f("<div>",{id:p}).menu();o.menu("appendItems",r)}return o}function m(p){var o={};f.each(p,function(){var r=this;if(r.onclick){var q=r.id||r.text;o[q]=r.onclick;delete r.onclick}if(r.submenu&&f.isArray(r.submenu)&&r.submenu.length>0){f.extend(o,m(r.submenu))}});return o}function n(s){var p=f.extend(true,{},f.fn.tabs.defaults,f.data(s,"tabs").options);var o=p.customAttr.contextMenu;if(!o.isShow){return}var t=l(s);if(o.isMerge&&f.isArray(o.items)&&o.items.length>0){t=f.merge(t,o.items)}if(!o.isMerge&&f.isArray(o.items)&&o.items.length>0){t=o.items}var r=m(t);var q=h(s,t);f(s).tabs("addEventListener",{name:"onContextMenu",handler:function(v,w,u){v.preventDefault();j(s,q,u);q.menu("addEventListener",{name:"onClick",override:true,handler:function(y){var x=y.id||y.text;if(r[x]){r[x].call(this,y,w,u,s)}}}).menu("show",{left:v.pageX,top:v.pageY})}})}function j(s,q,o){var r=g(s);var p=f("#"+r+"_fixed");if(f.inArray(o,f.fn.tabs.defaults.customAttr.fixedtabs)==-1&&!f(s).tabs("getTab",o).panel("options").closable){q.menu("setText",{target:p,text:f.fn.tabs.defaults.contextMenu.itemname.unfixtab})}else{q.menu("setText",{target:p,text:f.fn.tabs.defaults.contextMenu.itemname.fixtab});if(f.inArray(o,f.fn.tabs.defaults.customAttr.fixedtabs)>-1){q.menu("disableItem",p)}else{q.menu("enableItem",p)}}p=f("#"+r+"_close");if(!f(s).tabs("getTab",o).panel("options").closable){q.menu("disableItem",p)}else{q.menu("enableItem",p)}}function l(p){var o=g(p);return[{id:o+"_reload",text:f.fn.tabs.defaults.contextMenu.itemname.reload,onclick:f.fn.tabs.defaults.contextMenu.defaultEventsHandler.reload},{id:o+"_fixed",text:f.fn.tabs.defaults.contextMenu.itemname.fixtab,onclick:function(s,t,q,r){if(s.text==f.fn.tabs.defaults.contextMenu.itemname.fixtab){f.fn.tabs.defaults.contextMenu.defaultEventsHandler.fixtab(s,t,q,r)}else{f.fn.tabs.defaults.contextMenu.defaultEventsHandler.unfixtab(s,t,q,r)}}},"-",{id:o+"_close",text:f.fn.tabs.defaults.contextMenu.itemname.close,onclick:f.fn.tabs.defaults.contextMenu.defaultEventsHandler.closetab},{id:o+"_close_others",text:f.fn.tabs.defaults.contextMenu.itemname.closeothers,onclick:f.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeOthersTab},{id:o+"_close_rightside",text:f.fn.tabs.defaults.contextMenu.itemname.closerightside,onclick:f.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeRightSideTabs},{id:o+"_close_all",text:f.fn.tabs.defaults.contextMenu.itemname.closeall,onclick:f.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeAll}]}function a(p,o){var q=[];o++;f(p).children("div.tabs-header").find("ul li:nth-child("+o+")").each(function(){q.push(this)});return q.length>0?q[0]:null}function b(u,r,o,v){if(typeof o=="number"&&typeof r=="number"){var w=f.data(u,"tabs").tabs;if(o<0||o>w.length){return}if(r<0||r>w.length){return}if(v){var y=w[o];for(var q=o;q>r;q--){w.splice(q,1,w[q-1])}w[r]=y;var x=a(u,r);if(x){var t=a(u,o);f(x).before(t)}}else{var y=w[r];for(var p=r;p<=o;p++){w.splice(p,1,w[p+1])}w[o]=y;var x=a(u,o);if(x){var s=a(u,r);f(x).after(s)}}}}function e(r){var p=f(r).tabs("tabs");var s=[];for(var o=0;o<p.length;o++){var q=p[o];if(q.panel("options").closable==undefined||!q.panel("options").closable){s.push(q)}}return s}function d(s,r,o){var q=f("<iframe>").attr("height","98%").attr("width","100%").attr("marginheight","0").attr("marginwidth","0").attr("frameborder","0");setTimeout(function(){q.attr("src",o)},1);var p=f(s).tabs("getTab",r);p.panel("body").empty().append(q)}f.fn.tabs.defaults.contextMenu={};f.fn.tabs.defaults.contextMenu.itemname={};f.fn.tabs.defaults.contextMenu.itemname.reload="重新加载";f.fn.tabs.defaults.contextMenu.itemname.fixtab="固定标签页";f.fn.tabs.defaults.contextMenu.itemname.unfixtab="取消固定标签";f.fn.tabs.defaults.contextMenu.itemname.close="关闭标签页";f.fn.tabs.defaults.contextMenu.itemname.closeothers="关闭其他标签页";f.fn.tabs.defaults.contextMenu.itemname.closerightside="关闭右侧标签页";f.fn.tabs.defaults.contextMenu.itemname.closeall="关闭所有标签页";f.fn.tabs.defaults.contextMenu.defaultEventsHandler={reload:function(p,r,o,q){f(q).tabs("getTab",o).panel("refresh")},fixtab:function(r,t,p,s){var q=f(s).tabs("getTab",p);f(s).tabs("update",{tab:q,options:{closable:false}});var o=f.fn.tabs.defaults.customAttr.fixedtabs.length;b(s,o,p,true)},unfixtab:function(r,t,o,s){var p=e(s).length-1;var q=f(s).tabs("getTab",o);f(s).tabs("update",{tab:q,options:{closable:true}});b(s,o,p)},closetab:function(q,s,p,r){var o=f(r).tabs("getTab",p).panel("options");if(o.closable){f(r).tabs("close",p)}},closeOthersTab:function(s,r,p,t){var q=f(t).tabs("tabs");var o=f.grep(q,function(v,u){return v.panel("options").closable&&u!=p});f.each(o,function(){f(t).tabs("close",this.panel("options").title)})},closeRightSideTabs:function(r,t,p,s){var q=f(s).tabs("tabs");var o=f.grep(q,function(v,u){return u>p&&v.panel("options").closable});f.each(o,function(){f(s).tabs("close",this.panel("options").title)})},closeAll:function(r,t,p,s){var q=f(s).tabs("tabs");var o=f.grep(q,function(v,u){return v.panel("options").closable});f.each(o,function(){f(s).tabs("close",this.panel("options").title)})}};function c(s,o,r,q){var p=f(s).tabs("options");var t=p[o];switch(o){case"onLoad":if(q){p[o]=r}else{p[o]=function(u){t.apply(this,arguments);r.apply(this,arguments)}}break;case"onContextMenu":if(q){p[o]=r}else{p[o]=function(v,w,u){t.apply(this,arguments);r.apply(this,arguments)}}break;default:if(q){p[o]=r}else{p[o]=function(v,u){t.apply(this,arguments);r.apply(this,arguments)}}break}}f.fn.tabs.defaults.customAttr={fixedtabs:[0],contextMenu:{isShow:false,isMerge:true,items:[]}};var k=f.extend({},f.fn.tabs.methods);f.extend(f.fn.tabs.methods,{followCustomHandle:function(o){return o.each(function(){n(this)})},add:function(p,o){return p.each(function(){var q=null;if(o.href||/^url:/.test(o.content)){q=o.href||o.content.substr(4,o.content.length);delete o.content;delete o.href}if(q){if(o.useiframe){k.add(p,o);d(this,o.title,q)}else{k.add(p,f.extend(o,{href:q}))}}else{k.add(p,o)}if(o.css){f(this).tabs("getTab",o.title).css(o.css)}})},addEventListener:function(p,o){return p.each(function(){var q=f.isArray(o)?o:[o];var r=this;f.each(q,function(s,t){c(r,t.name,t.handler||function(){},t.override)})})}})})(jQuery);(function($){function init(target){var options=$(target).toolbar("options");var tb=$(target).addClass("dialog-toolbar panel-body");if(options.data||options.url){tb.append('<table cellspacing="0" cellpadding="0"><tr></tr></table>');if(options.buttonPosition=="right"){tb.find("table").css("float","right")}if($.isArray(options.data)){add(target,options.data)}}}function add(target,items){var tr=$(target).find("tr");for(var i=0;i<items.length;i++){var item=items[i];if(item=="-"){$('<td><div class="dialog-tool-separator"></div></td>').appendTo(tr)}else{var td=$("<td></td>").appendTo(tr);var button=$('<a href="javascript:void(0)"></a>').appendTo(td);button[0].onclick=eval(item.handler||function(){});button.linkbutton($.extend({},item,{plain:true}))}}}$.fn.toolbar=function(options,param){if(typeof options=="string"){return $.fn.toolbar.methods[options](this,param)}options=options||{};return this.each(function(){var state=$.data(this,"toolbar");if(state){$.extend(state.options,options)}else{$.data(this,"toolbar",{options:$.extend({},$.fn.toolbar.defaults,$.parser.parseOptions(this),options)});init(this)}})};$.fn.toolbar.methods={options:function(jq){return $.data(jq[0],"toolbar").options},add:function(jq,items){return jq.each(function(){add(this,items)})}};$.fn.toolbar.defaults={data:null,url:undefined,buttonPosition:"left"}})(jQuery);(function(b){function c(q){return b(q).attr("id")+"_contextmenu"}function d(s,t){var r=c(s);var q=b("#"+r);if(q.length==0){q=b("<div>",{id:r}).menu();q.menu("appendItems",t)}return q}function n(r){var q={};b.each(r,function(){var t=this;if(t.onclick){var s=t.id||t.text;q[s]=t.onclick;delete t.onclick}if(t.submenu&&b.isArray(t.submenu)&&t.submenu.length>0){b.extend(q,n(t.submenu))}});return q}function k(r){var q=c(r);return[{id:q+"_moveup",text:"位置上移",iconCls:"icon-moveup",onclick:b.fn.tree.contextmenu.defaultEvents.moveup},{id:q+"_movedown",text:"位置下移",iconCls:"icon-movedown",onclick:b.fn.tree.contextmenu.defaultEvents.movedown}]}function o(u){var r=b.extend(true,{},b.fn.tree.defaults,b(u).tree("options"));var q=r.customAttr.contextMenu;if(!q.isShow){return}var v=k(u);if(q.isMerge&&b.isArray(q.items)&&q.items.length>0){v=b.merge(v,q.items)}if(!q.isMerge&&b.isArray(q.items)&&q.items.length>0){v=q.items}var t=n(v);var s=d(u,v);b(u).tree("addEventListener",{name:"onContextMenu",handler:function(x,w){x.preventDefault();b(u).tree("select",w.target);s.menu("addEventListener",{name:"onClick",override:true,handler:function(z){var y=z.id||z.text;if(t[y]){t[y].call(this,z,w,u)}}}).menu("show",{left:x.pageX,top:x.pageY})}})}function e(w,r){var v=r.id||r.text;var x=b(w).tree("getParent",r.target);var q=j(w,x.target,false);var y=-1;for(var s=0,u=q.length;s<u;s++){var t=q[s].id||q[s].text;if(v==t){y=s-1;break}}if(y>-1){return q[y]}return null}function m(w,r){var v=r.id||r.text;var y=b(w).tree("getParent",r.target);var q=j(w,y.target,false);var x=-1;for(var s=0,u=q.length;s<u;s++){var t=q[s].id||q[s].text;if(v==t){x=s+1;break}}if(x>-1&&x<q.length){return q[x]}return null}function j(t,s,q){if(q){return b(t).tree("getChildren",s)}else{var r=[];b(s).next().find(">li>div.tree-node").each(function(){r.push(b(t).tree("getNode",this))});return r}}function h(r){var q=b.extend(true,{},b.fn.tree.defaults,b(r).tree("options"));if(!q.customAttr.expandOnNodeClick&&!q.customAttr.expandOnDblClick){return}if(q.customAttr.expandOnNodeClick){b(r).tree("addEventListener",{name:"onClick",handler:function(s){b(r).tree("toggle",s.target)}});return}if(q.customAttr.expandOnDblClick){b(r).tree("addEventListener",{name:"onDblClick",handler:function(s){b(r).tree("toggle",s.target)}})}}function g(s,r){var t=1;var q=b(s).tree("getParent",r.target);if(!q){return 1}return t+g(s,q)}function p(v,w,u){var q=u?[u]:b(v).tree("getRoots");for(var t=0;t<q.length;t++){var s=j(v,q[t].target,false);for(var r=0;r<s.length;r++){b(v).tree("expandTo",s[r].target)}w--;if(w>0){for(var r=0;r<s.length;r++){p(v,w,s[r])}}}}function l(r){var q=b.extend(true,{},b.fn.tree.defaults,b(r).tree("options"));if(!q.customAttr.onlyNodeExpand){return}b(r).tree("addEventListener",{name:"onBeforeExpand",handler:function(v){var u=b(r).tree("getParent",v.target);if(u){var t=j(r,u.target,false);for(var s=0;s<t.length;s++){if(t[s].state=="open"){b(r).tree("collapseAll",t[s].target)}}}else{b(r).tree("collapseAll")}}})}function a(u,q,t,s){var r=b(u).tree("options");var v=r[q];switch(q){case"onBeforeLoad":if(s){r[q]=t}else{r[q]=function(w,x){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onLoadSuccess":if(s){r[q]=t}else{r[q]=function(w,x){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onLoadError":if(s){r[q]=t}else{r[q]=function(w){v.apply(this,w);t.apply(this,w)}}break;case"onBeforeCheck":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onCheck":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onContextMenu":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onDragEnter":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onDragOver":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onDragLeave":if(s){r[q]=t}else{r[q]=function(x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onBeforeDrop":if(s){r[q]=t}else{r[q]=function(y,x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;case"onDrop":if(s){r[q]=t}else{r[q]=function(y,x,w){v.apply(this,arguments);t.apply(this,arguments)}}break;default:if(s){r[q]=t}else{r[q]=function(w){v.apply(this,arguments);t.apply(this,arguments)}}break}}b.fn.tree.contextmenu={};b.fn.tree.contextmenu.defaultEvents={moveup:function(u,t,v){var r=b.extend(true,{},b.fn.tree.defaults,b(v).tree("options"));var s=e(v,t);if(s){var q=b(v).tree("pop",t.target);b(v).tree("insert",{before:s.target,data:q});r.customAttr.onAfterMove.call(this,s,t)}},movedown:function(u,t,v){var s=b.extend(true,{},b.fn.tree.defaults,b(v).tree("options"));var r=m(v,t);if(r){var q=b(v).tree("pop",t.target);b(v).tree("insert",{after:r.target,data:q});s.customAttr.onAfterMove.call(this,r,t)}}};b.fn.tree.defaults.customAttr={idField:null,textField:null,parentField:null,iconField:null,expandOnNodeClick:false,expandOnDblClick:false,onlyNodeExpand:false,contextMenu:{isShow:false,isMerge:true,items:[]},onAfterMove:function(r,q){}};b.fn.tree.defaults.loadFilter=function(v,y){var r=b(this).tree("options").customAttr;if(r&&r.parentField){var q=r.idField||"id",t=r.textField||"text",s=r.iconField||"icon",x=r.parentField||"pid";var z=[],A=[];for(var u=0,w=v.length;u<w;u++){A[v[u][q]]=v[u]}for(var u=0,w=v.length;u<w;u++){if(A[v[u][x]]&&v[u][q]!=v[u][x]){if(!A[v[u][x]]["children"]){A[v[u][x]]["children"]=[]}v[u]["text"]=v[u][t];v[u][s]&&(v[u]["iconCls"]=v[u][s]);A[v[u][x]]["children"].push(v[u])}else{v[u]["text"]=v[u][t];z.push(v[u])}}return z}return v};var f=b.extend({},b.fn.tree.methods);b.extend(b.fn.tree.methods,{followCustomHandle:function(q){return q.each(function(){o(this);h(this);l(this)})},getLevel:function(r,q){return g(r[0],q)},expandTo:function(r,q){return r.each(function(){if(b.type(q)=="number"){var s=q;p(this,s)}else{f.expandTo(r,q)}})},addEventListener:function(r,q){return r.each(function(){var s=b.isArray(q)?q:[q];var t=this;b.each(s,function(u,v){a(t,v.name,v.handler||function(){},v.override)})})}})})(jQuery);(function(d){function e(o,n){return d(o).attr("id")+"_"+n}function g(q,r,n){var p=e(q,n);var o=d("#"+p);if(o.length==0){o=d("<div>",{id:p}).menu();o.menu("appendItems",r)}return o}function l(o){var n={};d.each(o,function(){var q=this;if(q.onclick){var p=q.id||q.text;n[p]=q.onclick;delete q.onclick}if(q.submenu&&d.isArray(q.submenu)&&q.submenu.length>0){d.extend(n,l(q.submenu))}});return n}function j(o){var n=e(o,"rowContextMenu");return[{id:n+"_delete",text:"删除",iconCls:"icon-remove",onclick:d.fn.treegrid.headerContextMenu.defaultEvents.doRemove},"-",{id:n+"_reload",text:"刷新",iconCls:"icon-reload",onclick:d.fn.treegrid.headerContextMenu.defaultEvents.doReload}]}function m(r){var n=d.extend(true,{},d.fn.treegrid.defaults,d(r).treegrid("options"));var o=n.customAttr.contextMenu;if(!o.isShow){return}var s=j(r);if(o.isMerge&&d.isArray(o.items)&&o.items.length>0){d.merge(s,o.items)}if(!o.isMerge&&d.isArray(o.items)&&o.items.length>0){s=o.items}var q=l(s);var p=g(r,s,"rowContextMenu");d(r).treegrid("addEventListener",{name:"onContextMenu",handler:function(u,v){u.preventDefault();d(r).treegrid("select",v[n.idField]);var t=p.menu("options");t.onClickCallback=t.onClickCallback||t.onClick;p.menu("addEventListener",{name:"onClick",override:true,handler:function(x){var w=x.id||x.text;if(q[w]){q[w].call(this,x,v,r)}}}).menu("show",{left:u.pageX,top:u.pageY})}})}function f(t){var s=e(t,"headerContextMenu");var n=[{text:"显示/隐藏列",iconCls:"icon-columns",submenu:[{id:s+"_showAll",text:"全部显示",iconCls:"icon-columns",onclick:function(v,w,u){d.fn.datagrid.headerContextMenu.defaultEvents.doShowAll(u)}},{id:s+"_restore",text:"还原",iconCls:"icon-columns",onclick:function(v,w,u){d.fn.datagrid.headerContextMenu.defaultEvents.doRestore(u)}},"-"]}];var o=function(u){return u.substr(u.lastIndexOf("_")+1,u.length)};var q=[];var r=d(t).treegrid("getColumnFields");var p=d(t).treegrid("options").treeField;d.each(r,function(v,x){if(!x){return true}var w=x==p?true:false;var u=d(t).treegrid("getColumnOption",x);u._hidden=u.hidden;q.push({id:s+"_"+x,text:u.title,iconCls:u.hidden?"icon-unchecked":"icon-checked",disabled:w,onclick:function(z,y,C){var B=o(z.id);var A=d(C).treegrid("getColumnOption",B).hidden;if(!A){d.fn.datagrid.headerContextMenu.defaultEvents.doHideColumn(C,B,z)}else{d.fn.datagrid.headerContextMenu.defaultEvents.doShowColumn(C,B,z)}}})});d.merge(n[0].submenu,q);return n}function k(q){var o=d.extend(true,{},d.fn.treegrid.defaults,d(q).treegrid("options"));var s=o.customAttr.headerContextMenu;if(!s.isShow){return}var r=f(q);if(s.isMerge){d.merge(r,s.items)}if(!s.isMerge&&d.isArray(s.items)&&s.items.length>0){r=s.items}var p=l(r);var n=g(q,r,"headerContextMenu");d(q).treegrid("addEventListener",{name:"onHeaderContextMenu",handler:function(u,t){u.preventDefault();n.menu("addEventListener",{name:"onClick",override:true,handler:function(w){var v=w.id||w.text;if(p[v]){p[v].call(this,w,t,q)}}}).menu("show",{left:u.pageX,top:u.pageY})}})}function a(q){var p=d.extend(true,{},d.fn.treegrid.defaults,d(q).treegrid("options"));if(!p.customAttr.expandOnNodeClick&&!p.customAttr.expandOnDblClick){return}var n=p.treeField;var o=p.idField;if(p.customAttr.expandOnNodeClick){d(q).treegrid("addEventListener",{name:"onClickCell",handler:function(r,s){if(n==r){d(q).treegrid("toggle",s[o])}}});return}if(p.customAttr.expandOnDblClick){d(q).treegrid("addEventListener",{name:"onDblClickCell",handler:function(r,s){if(n==r){d(q).treegrid("toggle",s[o])}}})}}function b(s){var o=d.extend(true,{},d.fn.treegrid.defaults,d(s).treegrid("options"));if(!o.customAttr.rowediting){return}var t=function(u){return d(u).attr("id")+"_editor_buttons_panel"};var n=120;var q=function(y){var x=t(y);if(d("#"+x).length>0){return}var v=d(y).treegrid("getPanel");var w=d(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",v);w.css("position","relative");var u=d("<div>",{id:x}).addClass("dialog-button").appendTo(w).css({position:"absolute",display:"block","border-bottom":"1px solid #ddd","border-left":"1px solid #ddd","border-right":"1px solid #ddd",left:parseInt(v.width()/2)-n,"z-index":2013,display:"none",padding:"4px 5px"});d('<a href="javascript:void(0)">确定</a>').css("margin-left","0px").linkbutton({iconCls:"icon-ok"}).click(function(){var z=o.idField;var A=d(y).treegrid("getEditingRow");d(y).treegrid("endEdit",A[z])}).appendTo(u);d('<a href="javascript:void(0)">取消</a>').css("margin-left","6px").linkbutton({iconCls:"icon-cancel"}).click(function(){var z=o.idField;var A=d(y).treegrid("getEditingRow");d(y).treegrid("cancelEdit",A[z])}).appendTo(u)};var r=function(A,C){var v=o.idField;var B=o.finder.getTr(A,C[v],"body",2);var x=B.position();var w="#"+t(A);var u=d(A).treegrid("getPanel");var y=d(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",u);var z=function(){var D=B.height(),E=B.width();var G=x.top+y.scrollTop(),F=x.left;var H=11;if(E>y.width()){F=y.width()/2-n}else{F=E/2-n}if(x.top+(D*2+H)>y.height()){G=G-(D+H)}else{G=G+D}return{top:G,left:F}};d(w).css(z()).show()};var p=function(v){var u="#"+t(v);d(u).hide()};d(s).treegrid("addEventListener",[{name:"onLoadSuccess",handler:function(v,u){q(this)}},{name:"onBeforeEdit",handler:function(u){r(s,u)}},{name:"onAfterEdit",handler:function(v,u){p(s)}},{name:"onCancelEdit",handler:function(u){p(s)}}])}function h(p){var o=d.extend(true,{},d.fn.treegrid.defaults,d(p).treegrid("options"));if(!o.customAttr.tooltip.enable){return}var s=function(v,u){var t={position:o.customAttr.tooltip.position,trackMouse:true,onHide:function(){d(v).tooltip("destroy")},onShow:function(){if(d.isPlainObject(u)&&u.css){d(this).tooltip("tip").css(u.css)}}};d.extend(t,d.isPlainObject(u)?u:{content:u});d(v).tooltip(t).tooltip("show")};var r=function(y,u){var x=d(y).attr("node-id");var w=d(p).treegrid("find",x);var t=function(B){var A=[];var z=d.grep(d.merge(d(p).treegrid("getColumnFields",true),d(p).treegrid("getColumnFields")),function(D,C){return d.trim(D).length>0});d.each(z,function(){var C=this;var D=d(p).treegrid("getColumnOption",C).title;A.push(D+": "+B[C])});return A.join("<br>")};var v=u?u(x,w):t(w);d(y).mouseover(function(){s(this,v)})};var n=function(t,u){t.mouseover(function(){var y=d(this).parent().attr("node-id");var w=d(p).treegrid("find",y);var z=d(this).attr("field");var x=w[z];var v=u?u(x,z,y,w):x;s(this,v)})};var q=function(){if(o.customAttr.tooltip.target=="row"){o.finder.getTr(p,"","allbody").each(function(){if(d(this).hasClass("datagrid-row")){r(this,o.customAttr.tooltip.formatter)}})}else{if(o.customAttr.tooltip.fields&&d.isArray(o.customAttr.tooltip.fields)){var t=d(p).treegrid("getPanel");var u=d(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",t);d.each(o.customAttr.tooltip.fields,function(){var v=this;n(d("td[field="+v+"]",u),o.customAttr.tooltip.formatter)})}}};d(p).treegrid("addEventListener",{name:"onLoadSuccess",handler:function(u,t){q()}})}function c(r,n,q,p){var o=d(r).treegrid("options");var s=o[n];switch(n){case"onClickRow":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onDblClickRow":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onClickCell":if(p){o[n]=q}else{o[n]=function(t,u){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onDblClickCell":if(p){o[n]=q}else{o[n]=function(t,u){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onBeforeLoad":if(p){o[n]=q}else{o[n]=function(u,t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onLoadSuccess":if(p){o[n]=q}else{o[n]=function(u,t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onLoadError":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,t);q.apply(this,t)}}break;case"onBeforeExpand":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onExpand":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onBeforeCollapse":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onCollapse":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onContextMenu":if(p){o[n]=q}else{o[n]=function(t,u){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onBeforeEdit":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onAfterEdit":if(p){o[n]=q}else{o[n]=function(u,t){s.apply(this,arguments);q.apply(this,arguments)}}break;case"onCancelEdit":if(p){o[n]=q}else{o[n]=function(t){s.apply(this,arguments);q.apply(this,arguments)}}break;default:d(r).datagrid("addEventListener",{name:n,override:p,handler:q});break}}d.fn.treegrid.headerContextMenu={};d.fn.treegrid.headerContextMenu.defaultEvents={doRemove:function(n,p,o){d.messager.confirm("疑问","您确定要删除已选中的行？",function(s){if(s){var q=d(o).treegrid("options").idField;var t=p[q];d(o).treegrid("remove",t)}})},doReload:function(n,p,o){d(o).treegrid("reload")}};d.fn.treegrid.defaults.customAttr={iconField:null,parentField:null,expandOnNodeClick:false,expandOnDblClick:false,headerContextMenu:{isShow:false,isMerge:true,items:[]},contextMenu:{isShow:false,isMerge:true,items:[]},rowediting:false,tooltip:{enable:false,target:"row",position:"bottom",fields:undefined,formatter:undefined}};d.fn.treegrid.defaults.loadFilter=function(p,r){var v=d(this).treegrid("options");var u=v.customAttr;if(u&&u.parentField){var n=v.idField,t=u.parentField,o=u.iconField||"icon";for(var q=0,s=p.rows.length;q<s;q++){if(p.rows[q][n]!=p.rows[q][t]){p.rows[q]["_parentId"]=p.rows[q][t]}else{delete p.rows[q][t]}p.rows[q]["iconCls"]=p.rows[q][o]}}return p};d.extend(d.fn.treegrid.methods,{followCustomHandle:function(n){return n.each(function(){k(this);m(this);a(this);b(this);h(this)})},getEditingRow:function(p){var n=p.treegrid("options");var o=[];n.finder.getTr(p[0],"","allbody").each(function(){if(d(this).hasClass("datagrid-row-editing")){var q=d(this).attr("node-id");o.push(p.treegrid("find",q))}});return o.length>0?o[0]:null},addEventListener:function(o,n){return o.each(function(){var p=d.isArray(n)?n:[n];var q=this;d.each(p,function(r,s){c(q,s.name,s.handler||function(){},s.override)})})}})})(jQuery);(function(a){a.extend(a.fn.validatebox.defaults.rules,{unequal:{validator:function(b,c){return b!=c},message:a.fn.validatebox.defaults.missingMessage},minLength:{validator:function(b,c){return b.length>=c[0]}},equals:{validator:function(b,c){if(/^#/.test(c)){return b==a(c).val()}else{return b==c}}}});if(a.fn.validatebox){a.fn.validatebox.defaults.rules.minLength.message="请至少输入{0}个字符。";a.fn.validatebox.defaults.rules.equals.message="字段不匹配"}})(jQuery);(function($){function getTop(w,options){var _doc;try{_doc=w.top.document;_doc.getElementsByTagName}catch(e){return w}if(options.locate=="document"||_doc.getElementsByTagName("frameset").length>0){return w}return w.top}function setWindowSize(w,options){var _top=getTop(w,options);var wHeight=$(_top).height(),wWidth=$(_top).width();if(options.locate=="top"||options.locate=="document"){if(options.height=="auto"){options.height=wHeight*0.6}if(options.width=="auto"){options.width=wWidth*0.6}}else{var locate=/^#/.test(options.locate)?options.locate:"#"+options.locate;if(options.height=="auto"){options.height=$(locate).height()*0.6}if(options.width=="auto"){options.width=$(locate).width()*0.6}}}$.extend({showWindow:function(options){options=options||{};var target;var winOpts=$.extend({},{iconCls:"icon-form",useiframe:false,locate:"top",data:undefined,width:"auto",height:"auto",cache:false,minimizable:true,maximizable:true,collapsible:true,resizable:true,onClose:function(){target.dialog("destroy")}},options);var iframe=null;if(/^url:/.test(winOpts.content)){var url=winOpts.content.substr(4,winOpts.content.length);if(winOpts.useiframe){iframe=$("<iframe>").attr("height","98%").attr("width","100%").attr("marginheight",0).attr("marginwidth",0).attr("frameborder",0);setTimeout(function(){iframe.attr("src",url)},10)}else{winOpts.href=url}delete winOpts.content}var callbackArguments={getData:function(name){return winOpts.data?winOpts.data[name]:null},close:function(){target.panel("close")}};var _top=getTop(window,winOpts);var warpHandler=function(handler){if(typeof handler=="function"){return function(){handler(callbackArguments)}}if(typeof handler=="string"&&winOpts.useiframe){return function(){iframe[0].contentWindow[handler](callbackArguments)}}if(typeof handler=="string"){return function(){eval(_top[handler])(callbackArguments)}}};setWindowSize(window,winOpts);if(winOpts.toolbar&&$.isArray(winOpts.toolbar)){$.each(winOpts.toolbar,function(i,button){button.handler=warpHandler(button.handler)})}if(winOpts.buttons&&$.isArray(winOpts.buttons)){$.each(winOpts.buttons,function(i,button){button.handler=warpHandler(button.handler)})}var onLoadCallback=winOpts.onLoad;winOpts.onLoad=function(){onLoadCallback&&onLoadCallback.call(this,callbackArguments,_top)};if(winOpts.locate=="top"||winOpts.locate=="document"){if(winOpts.useiframe&&iframe){iframe.bind("load",function(){onLoadCallback&&onLoadCallback.call(this,callbackArguments,iframe[0].contentWindow)});target=_top.$("<div>").append(iframe).dialog(winOpts)}else{target=_top.$("<div>").dialog(winOpts)}}else{var locate=/^#/.test(winOpts.locate)?winOpts.locate:"#"+winOpts.locate;target=$("<div>").appendTo(locate).dialog($.extend({},winOpts,{inline:true}))}return target},showModalDialog:function(options){options=options||{};var opts=$.extend({},options,{modal:true,minimizable:false,maximizable:false,resizable:false,collapsible:false});return $.showWindow(opts)}})})(jQuery);