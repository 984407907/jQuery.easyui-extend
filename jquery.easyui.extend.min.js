/**
 * Licensed under the GPL licenses
 * http://www.gnu.org/licenses/gpl.txt
 *
 * @author: 爱看书不识字<zjh527@163.com>
 * @date: 2013-7-12
 * https://github.com/loafer/jQuery.easyui-extend
 * http://blog.csdn.net/zjh527
 */
(function(c){function a(h){var j=c.extend(true,{},c.fn.combobox.defaults,c(h).combobox("options"));var f=j.customAttr.slave;if(f.id==null){return}if(/^#/.test(f.id)){f.id=f.id}else{f.id="#"+f.id}if(!j.multiple&&!j.editable){var g=j.onSelect;c(h).combobox({onSelect:function(k){g.call(h,k);b(h,f,k)}});var e=j.onChange;c(h).combo({onChange:function(l,k){e.call(h,l,k);if(l==null||l==""){c(f.id).combobox("clear").combobox("loadData",[]);c(h).combo("textbox").trigger("blur")}}})}}function b(g,h,e){if(h.remote){var f=h.url||c(h.id).combobox("options").url;if(f.indexOf("?")>-1){f+="&swd="+c(g).combobox("getValue")}else{f+="?swd="+c(g).combobox("getValue")}c(h.id).combobox("reload",f)}else{c(h.id).combobox("loadData",e.data)}}function d(f){var g=c(f).combobox("options");var e=c.extend(true,{},c.fn.combobox.defaults,g);if(!e.customAttr.headervalue){return}var h=g.onLoadSuccess;c(f).combobox({onLoadSuccess:function(){h.call(f);c(f).combobox("textbox").trigger("blur")}})}c.fn.combobox.defaults.customAttr={slave:{id:null,remote:true,url:null}};c.extend(c.fn.combobox.methods,{followCustomHandle:function(e){return e.each(function(){d(this);a(this);c(this).combo("followCustomHandle")})}})})(jQuery);(function(e){function c(j){var k=e.data(j,"combo").options;var h=e.extend(true,{},e.fn.combo.defaults,k);if(!h.customAttr.headervalue){return}if(k.required){var g=['unequal["'+h.customAttr.headervalue+'"]'];if(k.validType){if(typeof k.validType=="string"){g.push(k.validType);k.validType=g}if(e.isArray(k.validType)){e.merge(k.validType,g)}}else{e.extend(k,{validType:g})}}var f=k.onChange;e(j).combo({onChange:function(m,l){if(m==null||m==""){e(j).combo("setText",h.customAttr.headervalue)}f.call(j,m,l)}}).combo("textbox").val(h.customAttr.headervalue).attr("prompt",h.customAttr.headervalue).focus(function(){if(e(this).val()==h.customAttr.headervalue){e(this).val("")}}).blur(function(){if(e.trim(e(this).val())==""){e(this).val(h.customAttr.headervalue)}e(j).combo("validate")})}function a(g){var f=e.data(g,"combo").options;e(g).combo("setText","");if(f.multiple){e(g).combo("setValues",[])}else{e(g).combo("setValue","")}}function b(g){var f=e(g).combo("getValues");return f.length>0?(f[0]!=""?f[0]:null):null}function d(g){var h=e.extend(true,{},e.fn.combo.defaults,e.data(g,"combo").options);var f=h.customAttr.autocomplete;if(!f.enabled){return}e(g).combo("textbox").keyup(function(j){if(e(this).val().length!=0&&(e(this).val().length%f.minLength==0)&&f.url){e.ajax({type:"POST",url:f.url,data:{wd:e(this).val()},dataType:"json",success:function(m){var k=e(g).combo("panel").empty();for(var l=0;l<m.length;l++){e("<div>").addClass("combobox-item").attr("value",m[l].id).text(m[l].text).click(function(p){var n=e(this).attr("value");var o=e(this).text();e(g).combo("setValue",n).combo("setText",o).combo("hidePanel")}).hover(function(){e(this).addClass("combobox-item-hover")},function(){e(this).removeClass("combobox-item-hover")}).appendTo(k)}},error:function(k,m,l){e.messager.alert("Error",l,"error")}})}})}e.fn.combo.defaults.customAttr={headervalue:null,autocomplete:{enabled:false,minLength:3,url:undefined}};e.extend(e.fn.combo.methods,{followCustomHandle:function(f){return f.each(function(){c(this);d(this)})},clear:function(f){return f.each(function(){a(this)})},getValue:function(f){return b(f[0])}})})(jQuery);(function(c){function t(y,z,v){var x=h(y,v);var w=c("#"+x);if(w.length==0){w=c("<div>",{id:x}).menu().menu("appendItems",z)}return w}function h(w,v){return c(w).attr("id")+"_"+v}function r(w){var v={};c.each(w,function(){var y=this;if(y.onclick){var x=y.id||y.text;v[x]=y.onclick;delete y.onclick}if(y.submenu&&c.isArray(y.submenu)&&y.submenu.length>0){c.extend(v,r(y.submenu))}});return v}function l(C){var B=h(C,"headerContextMenu");var w=[{text:"显示/隐藏列",iconCls:"icon-columns",submenu:[{id:B+"_showAll",text:"全部显示",iconCls:"icon-columns",onclick:function(E,F,D){c.fn.datagrid.headerContextMenu.defaultEvents.doShowAll(D)}},{id:B+"_restore",text:"还原",iconCls:"icon-columns",onclick:function(E,F,D){c.fn.datagrid.headerContextMenu.defaultEvents.doRestore(D)}},"-"]}];var y=function(D){return D.substr(D.lastIndexOf("_")+1,D.length)};var z=[];var x=c(C).datagrid("getColumnFields",true);var A=c(C).datagrid("getColumnFields");v(A,false);function v(E,D){c.each(E,function(G,H){if(!H||H=="ck"){return true}var F=c(C).datagrid("getColumnOption",H);F._hidden=F.hidden;z.push({id:B+"_"+H,text:F.title,disabled:D,iconCls:F.hidden?"icon-unchecked":"icon-checked",onclick:function(J,I,M){var L=y(J.id);var K=c(M).datagrid("getColumnOption",L).hidden;if(!K){c.fn.datagrid.headerContextMenu.defaultEvents.doHideColumn(M,L,J)}else{c.fn.datagrid.headerContextMenu.defaultEvents.doShowColumn(M,L,J)}}})})}c.merge(w[0].submenu,z);return w}function k(z){var x=c.extend(true,{},c.fn.datagrid.defaults,c(z).datagrid("options"));var B=x.customAttr.headerContextMenu;if(!B.isShow){return}if(x.columns[0][0].checkbox){x.columns[0][0].field="ck"}var A=l(z);if(B.isMerge){c.merge(A,B.items)}if(!B.isMerge&&c.isArray(B.items)&&B.items>0){A=B.items}var y=r(A);var w=x.onHeaderContextMenu;var v=t(z,A,"headerContextMenu");c(z).datagrid({onHeaderContextMenu:function(D,C){D.preventDefault();v.menu({onClick:function(F){var E=F.id||F.text;if(y[E]){y[E].call(this,F,C,z)}},onShow:function(){B.onShow&&B.onShow.call(this,C,z)},onHide:function(){B.onHide&&B.onHide.call(this)}}).menu("show",{left:D.pageX,top:D.pageY});w.call(this,D,C)}})}function j(x){var w=h(x,"rowContextMenu");var v=[{id:w+"_add",text:"增加",iconCls:"icon-add",onclick:function(){}},{id:w+"_edit",text:"编辑",iconCls:"icon-edit",onclick:function(){}},{id:w+"_delete",text:"删除",iconCls:"icon-remove",onclick:function(z,B,A,y){c.messager.confirm("疑问","您确定要删除已选中的行？",function(C){if(C){c(y).datagrid("deleteRows",c(y).datagrid("getSelections"))}})}},"-",{id:w+"_reload",text:"刷新",iconCls:"icon-reload",onclick:function(z,B,A,y){c(y).datagrid("load")}},{id:w+"_reload_this_page",text:"刷新当前页",onclick:function(z,B,A,y){c(y).datagrid("reload")}},"-",{text:"导出",iconCls:"icon-table-export",submenu:[{id:w+"_export_this_page",text:"本页",iconCls:"icon-export-excel",onclick:function(){}},{id:w+"_export_all",text:"全部",iconCls:"icon-table-excel",onclick:function(){}}]}];return v}function e(A){var w=c.extend(true,{},c.fn.datagrid.defaults,c(A).datagrid("options"));var x=w.customAttr.rowContextMenu;if(!x.isShow){return}var B=j(A);if(x.isMerge){c.merge(B,x.items)}if(!x.isMerge&&c.isArray(x.items)&&x.items.length>0){B=x.items}var z=r(B);var y=w.onRowContextMenu;var v=t(A,B,"rowContextMenu");c(A).datagrid({onRowContextMenu:function(E,F,C){E.preventDefault();var D=v.menu("options");D.onClickCallback=D.onClickCallback||D.onClick;v.menu({onClick:function(H){if(D.onClickCallback.call(this,H,F,C,A)){return}var G=H.id||H.text;if(z[G]){z[G].call(this,H,F,C,A)}}}).menu("show",{left:E.pageX,top:E.pageY});y.call(this,E,F,C)}})}function f(B){var D=c.extend(true,{},c.fn.datagrid.defaults,c(B).datagrid("options"));if(!c.isArray(D.customAttr.slaveList)){return}if(D.customAttr.slaveList.length==0){return}var C={slaveList:D.customAttr.slaveList,activeSlave:D.customAttr.activeSlave};var x=c(B);var w=[];for(var A in C.slaveList){var y={id:C.slaveList[A].id,params:{}};var z={},v;if(!C.slaveList[A].relatedfield){v=x.datagrid("options").idField;z[v]="undefined"}else{v=C.slaveList[A].relatedfield;z[C.slaveList[A].relatedfield]="undefined"}c.extend(y.params,z,C.slaveList[A].queryParams);w.push(y)}if(C.activeSlave==c.fn.datagrid.defaults.customAttr.activeSlave){x.datagrid({onDblClickRow:function(G,F){for(var E in w){w[E].params[v]=F[v];c("#"+w[E].id).datagrid("load",w[E].params)}}})}}function o(A){var F=c.extend(true,{},c.fn.datagrid.defaults,c(A).datagrid("options"));if(!F.customAttr.rowediting){return}var x=function(G){return c(G).attr("id")+"_editor_buttons_panel"};var y=120;var D=function(K){var J=x(K);if(c("#"+J).length>0){return}var H=c(K).datagrid("getPanel");var I=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",H);I.css("position","relative");var G=c("<div>",{id:J}).addClass("dialog-button").appendTo(I).css({position:"absolute",display:"block","border-bottom":"1px solid #ddd","border-left":"1px solid #ddd","border-right":"1px solid #ddd",left:parseInt(H.width()/2)-y,"z-index":2013,display:"none",padding:"4px 5px"});c('<a href="javascript:void(0)">确定</a>').css("margin-left","0px").linkbutton({iconCls:"icon-ok"}).click(function(){var L=c(K).datagrid("getRowIndex",c(K).datagrid("getEditingRow"));c(K).datagrid("endEdit",L)}).appendTo(G);c('<a href="javascript:void(0)">取消</a>').css("margin-left","6px").linkbutton({iconCls:"icon-cancel"}).click(function(){var L=c(K).datagrid("getRowIndex",c(K).datagrid("getEditingRow"));c(K).datagrid("cancelEdit",L)}).appendTo(G)};var w=function(N,L){var G=c.data(N,"datagrid").options;var O=G.finder.getTr(N,L,"body",2);var J=O.position();var M=function(){var P=O.height(),Q=O.width();var S=J.top+K.scrollTop(),R=J.left;var T=11;if(Q>K.width()){R=K.width()/2-y}else{R=Q/2-y}if(J.top+(P*2+T)>K.height()){S=S-(P+T)}else{S=S+P}return{top:S,left:R}};var I="#"+x(N);var H=c(N).datagrid("getPanel");var K=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",H);c(I).css(M()).show()};var z=function(H){var G="#"+x(H);c(G).hide()};var B=F.onLoadSuccess;var E=F.onBeforeEdit;var C=F.onAfterEdit;var v=F.onCancelEdit;c(A).datagrid({onLoadSuccess:function(G){B.call(this,G);D(this)},onBeforeEdit:function(G,H){w(A,G);E.call(this,G,H)},onAfterEdit:function(G,I,H){z(A);C.call(this,G,I,H)},onCancelEdit:function(G,H){z(A);v.call(this,G,H)}})}function s(x){var w=c.extend(true,{},c.fn.datagrid.defaults,c(x).datagrid("options"));if(!w.customAttr.tooltip.enable){return}var B=function(E,D){var C={position:w.customAttr.tooltip.position,trackMouse:true,onHide:function(){c(E).tooltip("destroy")},onShow:function(){if(c.isPlainObject(D)&&D.css){c(this).tooltip("tip").css(D.css)}}};c.extend(C,c.isPlainObject(D)?D:{content:D});c(E).tooltip(C).tooltip("show")};var A=function(G,D){var H=parseInt(G.attr("datagrid-row-index"));var F=c(x).datagrid("getRows")[H];var C=function(K){var J=[];var I=c.grep(c.merge(c(x).datagrid("getColumnFields",true),c(x).datagrid("getColumnFields")),function(M,L){return c.trim(M).length>0});c.each(I,function(){var L=this;var M=c(x).datagrid("getColumnOption",L).title;J.push(M+": "+K[L])});return J.join("<br>")};var E=D?D(F,H):C(F);G.mouseover(function(){B(this,E)})};var v=function(C,D){C.mouseover(function(){var I=c(this).parent().attr("datagrid-row-index");var G=c(x).datagrid("getRows")[I];var H=c(this).attr("field");var F=G[H];var E=D?D(F,H):F;B(this,E)})};var z=function(){if(w.customAttr.tooltip.target=="row"){w.finder.getTr(x,"","allbody").each(function(){var E=c(this);if(E.hasClass("datagrid-row")){A(E,w.customAttr.tooltip.formatter)}})}else{if(w.customAttr.tooltip.fields&&c.isArray(w.customAttr.tooltip.fields)){var C=c(x).datagrid("getPanel");var D=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",C);c.each(w.customAttr.tooltip.fields,function(){var E=this;v(c("td[field="+E+"]",D),w.customAttr.tooltip.formatter)})}}};var y=w.onLoadSuccess;c(x).datagrid({onLoadSuccess:function(C){y.call(this,C);z()}})}function b(w){var v=c.extend(true,{},c.fn.datagrid.defaults,c(w).datagrid("options"));if(!v.pagination){return}var x=v.onLoadSuccess;c(w).datagrid({onLoadSuccess:function(y){c(w).datagrid("setPagination",v.customAttr.pagination);x.call(this,y)}})}function p(y){var w=c(y).datagrid("options");var v=function(C){var B=c(y).datagrid("getPanel");if(C.rows.length==0){var D=c("div.datagrid-view2>div.datagrid-header>div.datagrid-header-inner>table",B)[0];var A=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",B);c("<div>").html("&nbsp;").width(c(D).width()).appendTo(A)}else{c("div.datagrid-view2>div.datagrid-body>div",B).remove()}};var z=w.onLoadSuccess;var x=w.onLoadError;c(y).datagrid({onLoadSuccess:function(A){v(A);z.call(this,A)},onLoadError:function(){v({rows:[]});x.call(this)}})}function n(y,x){var v=c(y).datagrid("options");var z=c(y).datagrid("getColumnFields",true);var w=v.columns[0][0];if(z.length==0&&w.checkbox){u(y,"ck",2,1)}q(y,x,true);u(y,x,2,1)}function m(A,z){var v=c(A).datagrid("options");if(!v.frozenColumns[0]){v.frozenColumns=[[]]}var y=c(A).datagrid("getColumnOption",z);v.frozenColumns[0].push(y);x(y);c(A).datagrid(v);var w=c(A).datagrid("getHeaderContextMenu").menu("findItem",y.title);c(A).datagrid("getHeaderContextMenu").menu("disableItem",w.target);function x(D){for(var C=0;C<v.columns.length;C++){for(var B=0;B<v.columns[C].length;B++){if(v.columns[C][B].field==D.field){v.columns[C].splice(B,1);return}}}}}function u(z,A,B,C){var E=c(z).datagrid("options");var D=c.data(z,"datagrid").dc;var v=null;var v=(B==1?D.header1:D.header2).find(">table>tbody>tr.datagrid-header-row>td[field="+A+"]");if(B>C){(C==1?D.header1:D.header2).find(">table>tbody>tr.datagrid-header-row").append(v)}else{(C==1?D.header1:D.header2).find(">table>tbody>tr.datagrid-header-row").children("td[field]").each(function(){if(y(A,c(this).attr("field"))){c(this).before(v);return false}})}var w=(B==1?D.body1:D.body2).find(">table>tbody>tr>td[field="+A+"]");if(B>C){c.each(w,function(F,G){E.finder.getTr(z,F,"body",C).append(G)})}else{c.each(w,function(F,G){E.finder.getTr(z,F,"body",C).children("td[field]").each(function(){if(y(A,c(this).attr("field"))){c(this).before(G);return false}})})}c(z).datagrid("fixColumnSize");function y(F,G){return x(F)<x(G)}function x(F){return c.inArray(F,c(z).datagrid("getColumnFields"))}}function q(B,A,x){var w=C(A);var z=c(B).datagrid("getColumnOption",A);c.extend(z,{index:w});var v=c(B).datagrid("getHeaderContextMenu");var y=v.menu("findItem",z.title);if(x){v.menu("disableItem",y.target)}else{v.menu("enableItem",y.target)}function C(D){return c.inArray(D,c(B).datagrid("getColumnFields"))}}function g(B,A){var x=c(A).datagrid("getHeaderContextMenu");var z=c(A).datagrid("getColumnOption",B);var w=x.menu("findItem",z.title);if(w){if(!w.disabled){v("冻结此列");y("取消冻结")}else{v("取消冻结");y("冻结此列")}}else{y("冻结此列");y("取消冻结")}function y(D){var C=x.menu("findItem",D);if(C){x.menu("disableItem",C.target)}}function v(D){var C=x.menu("findItem",D);if(C){x.menu("enableItem",C.target)}}}function d(x,w,v){if(v){n(x,w)}else{m(x,w)}}function a(w,v){q(w,v,false);u(w,v,1,2)}c.fn.datagrid.headerContextMenu={};c.fn.datagrid.headerContextMenu.defaultEvents={doHideColumn:function(x,w,v){c(x).datagrid("hideColumn",w);var y=c(x).datagrid("getHeaderContextMenu");y.menu("setIcon",{target:v.target,iconCls:"icon-unchecked"})},doShowColumn:function(x,w,v){c(x).datagrid("showColumn",w);var y=c(x).datagrid("getHeaderContextMenu");y.menu("setIcon",{target:v.target,iconCls:"icon-checked"})},doShowAll:function(y){var v=c(y).datagrid("getColumnFields");var z=c(y).datagrid("getHeaderContextMenu");for(i in v){c(y).datagrid("showColumn",v[i]);var w=c(y).datagrid("getColumnOption",v[i]);var x=z.menu("findItem",w.title);if(x){z.menu("setIcon",{target:x.target,iconCls:"icon-checked"})}}},doRestore:function(y){var v=c(y).datagrid("getColumnFields");var z=c(y).datagrid("getHeaderContextMenu");for(i in v){var w=c(y).datagrid("getColumnOption",v[i]);var x=z.menu("findItem",w.title);if(!w._hidden){c(y).datagrid("showColumn",v[i]);x&&z.menu("setIcon",{target:x.target,iconCls:"icon-checked"})}else{c(y).datagrid("hideColumn",v[i]);x&&z.menu("setIcon",{target:x.target,iconCls:"icon-unchecked"})}}}};c.extend(c.fn.datagrid.defaults.editors,{my97:{init:function(v,x){var w=c('<input type="text" class="Wdate">').appendTo(v);x=x||{};x=c.extend({},x,{readOnly:true});return w.focus(function(){WdatePicker()})},getValue:function(v){return c(v).val()},setValue:function(w,v){c(w).val(v)},resize:function(x,w){var v=c(x);if(c.boxModel==true){v.width(w-(v.outerWidth()-v.width()))}else{v.width(w)}}},datetimebox:{init:function(v,x){var w=c('<input type="text" class="easyui-datetimebox">').appendTo(v);x=x||{};x=c.extend({},x,{formatter:function(y){return c.dateFormat(new Date(y),"yyyy-MM-dd hh:mm")}});return w.datetimebox(x)},getValue:function(v){return c(v).datetimebox("getValue")},setValue:function(w,v){c(w).datetimebox("setValue",v)},resize:function(w,v){c(w).datetimebox("resize",v)}},numberspinner:{init:function(v,x){var w=c('<input type="text">').appendTo(v);x=x||{};x=c.extend({},x,{min:0,editable:false});return w.numberspinner(x)},getValue:function(v){return c(v).numberspinner("getValue")},setValue:function(w,v){c(w).numberspinner("setValue",v)},resize:function(w,v){c(w).numberspinner("resize",v)}},timespinner:{init:function(v,x){var w=c('<input type="text">').appendTo(v);x=x||{};return w.timespinner(x)},getValue:function(v){return c(v).timespinner("getValue")},setValue:function(w,v){c(w).timespinner("setValue",v)},resize:function(w,v){c(w).timespinner("resize",v)}},combogrid:{init:function(v,x){var w=c('<input type="text">').appendTo(v);x=x||{};x=c.extend({},x,{panelWidth:400,editable:false});return w.combogrid(x)},getValue:function(v){return c(v).combogrid("getValue")},setValue:function(w,v){c(w).combogrid("setValue",v)},resize:function(w,v){c(w).combogrid("resize",v)}}});c.fn.datagrid.defaults.customAttr={headerContextMenu:{isShow:false,isMerge:true,items:[],onShow:function(w,v){},onHide:function(){}},rowContextMenu:{isShow:false,isMerge:true,items:[]},pagination:{showPageList:false,showRefresh:true,beforePageText:undefined,afterPageText:undefined,displayMsg:undefined},slaveList:undefined,activeSlave:"dblclickrow",rowediting:false,tooltip:{enable:false,target:"row",position:"bottom",fields:undefined,formatter:undefined}};c.extend(c.fn.datagrid.methods,{followCustomHandle:function(v){return v.each(function(){p(this);k(this);e(this);b(this);f(this);o(this);s(this)})},getHeaderContextMenu:function(v){return c("#"+h(v[0],"headerContextMenu"))},getRowContextMenu:function(v){return c("#"+h(v[0],"rowContextMenu"))},getEditingRow:function(z){var v=c.data(z[0],"datagrid");var x=v.options;var y=v.data;var w=[];x.finder.getTr(z[0],"","allbody").each(function(){if(c(this).hasClass("datagrid-row-editing")){var A=parseInt(c(this).attr("datagrid-row-index"));w.push(y.rows[A])}});return w.length>0?w[0]:null},setPagination:function(w,v){return w.each(function(){c(this).datagrid("getPager").pagination(v)})},deleteRows:function(w,v){return w.each(function(){var y=undefined;if(!c.isArray(v)){y=[v]}else{y=v}var x=this;c.each(y,function(A,B){if(c.isPlainObject(B)){var z=c(x).datagrid("getRowIndex",B);c(x).datagrid("deleteRow",z)}else{c(x).datagrid("deleteRow",B)}})})},freezeColumn:function(w,v){return w.each(function(){d(this,v,true)})},unfreezColumn:function(w,v){return w.each(function(){a(this,v)})}})})(jQuery);(function(a){a.extend({dateFormat:function(c,k){if(c==null){return null}if(k==null){var p="yyyy-MM-dd"}else{var p=k}var l=c.getFullYear().toString();var j=(c.getMonth()+1).toString();var m=c.getDate().toString();var n=c.getHours().toString();var e=c.getMinutes().toString();var o=c.getSeconds().toString();var d=p.replace(/[^y]/g,"");var q=p.replace(/[^M]/g,"");var b=p.replace(/[^d]/g,"");var g=p.replace(/[^h]/g,"");var f=p.replace(/[^m]/g,"");var h=p.replace(/[^s]/g,"");if(d.length==2){l=l.substring(2,4)}if(q.length>1&&j.length==1){j="0"+j}if(b.length>1&&m.length==1){m="0"+m}if(g.length>1&&n.length==1){n="0"+n}if(f.length>1&&e.length==1){e="0"+e}if(h.length>1&&o.length==1){o="0"+o}if(d.length>0){p=p.replace(d,l)}if(q.length>0){p=p.replace(q,j)}if(b.length>0){p=p.replace(b,m)}if(g.length>0){p=p.replace(g,n)}if(f.length>0){p=p.replace(f,e)}if(h.length>0){p=p.replace(h,o)}return p},parseDate:function(u,p){var t=new Date();if(u==null){return t}if(p==null){var m="yyyy-MM-dd"}else{var m=p}var w=m.replace(/[^y]/g,"");var l=m.replace(/[^M]/g,"");var h=m.replace(/[^d]/g,"");var x=m.replace(/[^h]/g,"");var d=m.replace(/[^m]/g,"");var f=m.replace(/[^s]/g,"");var j=m.indexOf(w);var q=w.length;var e=parseInt(u.substring(j,j+q));if(isNaN(e)){e=t.getYear()}else{if(q==2){if(e<50){e+=2000}else{e+=1900}}}var y=m.indexOf(l);var v=parseInt(u.substring(y,y+l.length));if(isNaN(v)){v=t.getMonth()}else{v-=1}var b=m.indexOf(h);var n=parseInt(u.substring(b,b+h.length));if(isNaN(n)){n=t.getDate()}var s=m.indexOf(x);var o=parseInt(u.substring(s,s+x.length));if(isNaN(o)){o=0}var c=m.indexOf(d);var k=parseInt(u.substring(c,c+d.length));if(isNaN(k)){k=0}var r=m.indexOf(f);var g=parseInt(u.substring(r,r+f.length));if(isNaN(g)){g=0}return new Date(e,v,n,o,k,g)}})})(jQuery);(function(b){function a(e,d,c){if(d&&b.isArray(d)){b.each(d,function(){var h=this;var g={};if(c){b.extend(g,{parent:c})}if(b.isPlainObject(h)){b(e).menu("appendItem",b.extend(h,g));if(h.submenu){var j=b(e).menu("findItem",h.text);a(e,h.submenu,j.target)}}else{if(h=="-"){var f=b(e).menu("appendItem",b.extend({text:h},g)).menu("findItem",h).target;b(f).removeClass("menu-item").addClass("menu-sep").removeAttr("style").empty()}}})}}b.extend(b.fn.menu.methods,{followCustomHandle:function(c){},appendItems:function(d,c){return d.each(function(){a(this,c)})}})})(jQuery);(function(a){function b(g){var e=a.extend(true,{},a.fn.panel.defaults,a(g).panel("options"));var f=e.customAttr.toolbar;if(!f){return}var c=a(g).panel("body");if(typeof f=="string"){a(f).addClass("dialog-toolbar panel-body").insertBefore(c);a(f).show()}else{var d=a("<div></div>").insertBefore(c);d.toolbar(f)}}a.fn.panel.defaults.customAttr={toolbar:{buttonPosition:"left",data:undefined}};a.extend(a.fn.panel.methods,{followCustomHandle:function(c){return c.each(function(){b(this)})}})})(jQuery);(function(a){var b=function(d,h){var e=d;var n=h;if(e<1){e=1}if(n<1){n=1}var c=parseInt(a(this).parent().css("width"))+14;var k=parseInt(a(this).parent().css("height"))+14;var j=e+c;var g=n+k;var m=a(window).width();var f=a(window).height();if(j>m){e=m-c}if(g>f){n=f-k}a(this).parent().css({left:e,top:n})};a.fn.dialog.defaults.onMove=b;a.fn.window.defaults.onMove=b;a.fn.panel.defaults.onMove=b;a.fn.panel.defaults=jQuery.extend({},a.fn.panel.defaults,{onBeforeDestroy:function(){var c=a("iframe",this);if(c.length>0){c[0].contentWindow.document.write("");c[0].contentWindow.close();c.remove();if(a.browser.msie){CollectGarbage()}}}})})(jQuery);(function(e){function f(n){return e(n).attr("id")+"_contextmenu"}function g(p,q){var o=f(p);var n=e("#"+o);if(n.length==0){n=e("<div>",{id:o}).menu();n.menu("appendItems",q)}return n}function l(o){var n={};e.each(o,function(){var q=this;if(q.onclick){var p=q.id||q.text;n[p]=q.onclick;delete q.onclick}if(q.submenu&&e.isArray(q.submenu)&&q.submenu.length>0){e.extend(n,l(q.submenu))}});return n}function m(r){var o=e.extend(true,{},e.fn.tabs.defaults,e.data(r,"tabs").options);var n=o.customAttr.contextMenu;if(!n.isShow){return}var s=k(r);if(n.isMerge&&e.isArray(n.items)&&n.items.length>0){s=e.merge(s,n.items)}if(!n.isMerge&&e.isArray(n.items)&&n.items.length>0){s=n.items}var q=l(s);var p=g(r,s);e(r).tabs({onContextMenu:function(u,v,t){u.preventDefault();h(r,p,t);p.menu({onClick:function(x){var w=x.id||x.text;if(q[w]){q[w].call(this,x,v,t,r)}}}).menu("show",{left:u.pageX,top:u.pageY})}})}function h(r,p,n){var q=f(r);var o=e("#"+q+"_fixed");if(e.inArray(n,e.fn.tabs.defaults.customAttr.fixedtabs)==-1&&!e(r).tabs("getTab",n).panel("options").closable){p.menu("setText",{target:o,text:e.fn.tabs.defaults.contextMenu.itemname.unfixtab})}else{p.menu("setText",{target:o,text:e.fn.tabs.defaults.contextMenu.itemname.fixtab});if(e.inArray(n,e.fn.tabs.defaults.customAttr.fixedtabs)>-1){p.menu("disableItem",o)}else{p.menu("enableItem",o)}}o=e("#"+q+"_close");if(!e(r).tabs("getTab",n).panel("options").closable){p.menu("disableItem",o)}else{p.menu("enableItem",o)}}function k(o){var n=f(o);return[{id:n+"_reload",text:e.fn.tabs.defaults.contextMenu.itemname.reload,onclick:e.fn.tabs.defaults.contextMenu.defaultEventsHandler.reload},{id:n+"_fixed",text:e.fn.tabs.defaults.contextMenu.itemname.fixtab,onclick:function(r,s,p,q){if(r.text==e.fn.tabs.defaults.contextMenu.itemname.fixtab){e.fn.tabs.defaults.contextMenu.defaultEventsHandler.fixtab(r,s,p,q)}else{e.fn.tabs.defaults.contextMenu.defaultEventsHandler.unfixtab(r,s,p,q)}}},"-",{id:n+"_close",text:e.fn.tabs.defaults.contextMenu.itemname.close,onclick:e.fn.tabs.defaults.contextMenu.defaultEventsHandler.closetab},{id:n+"_close_others",text:e.fn.tabs.defaults.contextMenu.itemname.closeothers,onclick:e.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeOthersTab},{id:n+"_close_rightside",text:e.fn.tabs.defaults.contextMenu.itemname.closerightside,onclick:e.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeRightSideTabs},{id:n+"_close_all",text:e.fn.tabs.defaults.contextMenu.itemname.closeall,onclick:e.fn.tabs.defaults.contextMenu.defaultEventsHandler.closeAll}]}function a(o,n){var p=[];n++;e(o).children("div.tabs-header").find("ul li:nth-child("+n+")").each(function(){p.push(this)});return p.length>0?p[0]:null}function b(t,q,n,u){if(typeof n=="number"&&typeof q=="number"){var v=e.data(t,"tabs").tabs;if(n<0||n>v.length){return}if(q<0||q>v.length){return}if(u){var x=v[n];for(var p=n;p>q;p--){v.splice(p,1,v[p-1])}v[q]=x;var w=a(t,q);if(w){var s=a(t,n);e(w).before(s)}}else{var x=v[q];for(var o=q;o<=n;o++){v.splice(o,1,v[o+1])}v[n]=x;var w=a(t,n);if(w){var r=a(t,q);e(w).after(r)}}}}function d(q){var o=e(q).tabs("tabs");var r=[];for(var n=0;n<o.length;n++){var p=o[n];if(p.panel("options").closable==undefined||!p.panel("options").closable){r.push(p)}}return r}function c(r,q,n){var p=e("<iframe>").attr("height","98%").attr("width","100%").attr("marginheight","0").attr("marginwidth","0").attr("frameborder","0");setTimeout(function(){p.attr("src",n)},1);var o=e(r).tabs("getTab",q);o.panel("body").empty().append(p)}e.fn.tabs.defaults.contextMenu={};e.fn.tabs.defaults.contextMenu.itemname={};e.fn.tabs.defaults.contextMenu.itemname.reload="重新加载";e.fn.tabs.defaults.contextMenu.itemname.fixtab="固定标签页";e.fn.tabs.defaults.contextMenu.itemname.unfixtab="取消固定标签";e.fn.tabs.defaults.contextMenu.itemname.close="关闭标签页";e.fn.tabs.defaults.contextMenu.itemname.closeothers="关闭其他标签页";e.fn.tabs.defaults.contextMenu.itemname.closerightside="关闭右侧标签页";e.fn.tabs.defaults.contextMenu.itemname.closeall="关闭所有标签页";e.fn.tabs.defaults.contextMenu.defaultEventsHandler={reload:function(o,q,n,p){e(p).tabs("getTab",n).panel("refresh")},fixtab:function(q,s,o,r){var p=e(r).tabs("getTab",o);e(r).tabs("update",{tab:p,options:{closable:false}});var n=e.fn.tabs.defaults.customAttr.fixedtabs.length;b(r,n,o,true)},unfixtab:function(q,s,n,r){var o=d(r).length-1;var p=e(r).tabs("getTab",n);e(r).tabs("update",{tab:p,options:{closable:true}});b(r,n,o)},closetab:function(p,r,o,q){var n=e(q).tabs("getTab",o).panel("options");if(n.closable){e(q).tabs("close",o)}},closeOthersTab:function(r,q,o,s){var p=e(s).tabs("tabs");var n=e.grep(p,function(u,t){return u.panel("options").closable&&t!=o});e.each(n,function(){e(s).tabs("close",this.panel("options").title)})},closeRightSideTabs:function(q,s,o,r){var p=e(r).tabs("tabs");var n=e.grep(p,function(u,t){return t>o&&u.panel("options").closable});e.each(n,function(){e(r).tabs("close",this.panel("options").title)})},closeAll:function(q,s,o,r){var p=e(r).tabs("tabs");var n=e.grep(p,function(u,t){return u.panel("options").closable});e.each(n,function(){e(r).tabs("close",this.panel("options").title)})}};e.fn.tabs.defaults.customAttr={fixedtabs:[0],contextMenu:{isShow:false,isMerge:true,items:[]}};var j=e.extend({},e.fn.tabs.methods);e.extend(e.fn.tabs.methods,{followCustomHandle:function(n){return n.each(function(){m(this)})},add:function(o,n){return o.each(function(){var p=null;if(n.href||/^url:/.test(n.content)){p=n.href||n.content.substr(4,n.content.length);delete n.content;delete n.href}if(p){if(n.useiframe){j.add(o,n);c(this,n.title,p)}else{j.add(o,e.extend(n,{href:p}))}}else{j.add(o,n)}})}})})(jQuery);(function($){function init(target){var options=$(target).toolbar("options");var tb=$(target).addClass("dialog-toolbar panel-body");if(options.data||options.url){tb.append('<table cellspacing="0" cellpadding="0"><tr></tr></table>');if(options.buttonPosition=="right"){tb.find("table").css("float","right")}if($.isArray(options.data)){add(target,options.data)}}}function add(target,items){var tr=$(target).find("tr");for(var i=0;i<items.length;i++){var item=items[i];if(item=="-"){$('<td><div class="dialog-tool-separator"></div></td>').appendTo(tr)}else{var td=$("<td></td>").appendTo(tr);var button=$('<a href="javascript:void(0)"></a>').appendTo(td);button[0].onclick=eval(item.handler||function(){});button.linkbutton($.extend({},item,{plain:true}))}}}$.fn.toolbar=function(options,param){if(typeof options=="string"){return $.fn.toolbar.methods[options](this,param)}options=options||{};return this.each(function(){var state=$.data(this,"toolbar");if(state){$.extend(state.options,options)}else{$.data(this,"toolbar",{options:$.extend({},$.fn.toolbar.defaults,$.parser.parseOptions(this),options)});init(this)}})};$.fn.toolbar.methods={options:function(jq){return $.data(jq[0],"toolbar").options},add:function(jq,items){return jq.each(function(){add(this,items)})}};$.fn.toolbar.defaults={data:null,url:undefined,buttonPosition:"left"}})(jQuery);(function(a){function b(p){return a(p).attr("id")+"_contextmenu"}function c(r,s){var q=b(r);var p=a("#"+q);if(p.length==0){p=a("<div>",{id:q}).menu();p.menu("appendItems",s)}return p}function m(q){var p={};a.each(q,function(){var s=this;if(s.onclick){var r=s.id||s.text;p[r]=s.onclick;delete s.onclick}if(s.submenu&&a.isArray(s.submenu)&&s.submenu.length>0){a.extend(p,m(s.submenu))}});return p}function j(q){var p=b(q);return[{id:p+"_moveup",text:"位置上移",iconCls:"icon-moveup",onclick:a.fn.tree.contextmenu.defaultEvents.moveup},{id:p+"_movedown",text:"位置下移",iconCls:"icon-movedown",onclick:a.fn.tree.contextmenu.defaultEvents.movedown}]}function n(t){var q=a.extend(true,{},a.fn.tree.defaults,a(t).tree("options"));var p=q.customAttr.contextMenu;if(!p.isShow){return}var u=j(t);if(p.isMerge&&a.isArray(p.items)&&p.items.length>0){u=a.merge(u,p.items)}if(!p.isMerge&&a.isArray(p.items)&&p.items.length>0){u=p.items}var s=m(u);var r=c(t,u);a(t).tree({onContextMenu:function(w,v){w.preventDefault();a(t).tree("select",v.target);r.menu({onClick:function(y){var x=y.id||y.text;if(s[x]){s[x].call(this,y,v,t)}}}).menu("show",{left:w.pageX,top:w.pageY})}})}function d(v,q){var u=q.id||q.text;var w=a(v).tree("getParent",q.target);var p=h(v,w.target,false);var x=-1;for(var r=0,t=p.length;r<t;r++){var s=p[r].id||p[r].text;if(u==s){x=r-1;break}}if(x>-1){return p[x]}return null}function l(v,q){var u=q.id||q.text;var x=a(v).tree("getParent",q.target);var p=h(v,x.target,false);var w=-1;for(var r=0,t=p.length;r<t;r++){var s=p[r].id||p[r].text;if(u==s){w=r+1;break}}if(w>-1&&w<p.length){return p[w]}return null}function h(s,r,p){if(p){return a(s).tree("getChildren",r)}else{var q=[];a(r).next().find(">li>div.tree-node").each(function(){q.push(a(s).tree("getNode",this))});return q}}function g(s){var q=a.extend(true,{},a.fn.tree.defaults,a(s).tree("options"));if(!q.customAttr.expandOnNodeClick&&!q.customAttr.expandOnDblClick){return}if(q.customAttr.expandOnNodeClick){var p=q.onClick;a(s).tree({onClick:function(t){a(s).tree("toggle",t.target);p&&p.call(this,t)}});return}if(q.customAttr.expandOnDblClick){var r=q.onDblClick;a(s).tree({onDblClick:function(t){a(s).tree("toggle",t.target);r&&r.call(this,t)}})}}function f(s,q){var r=a(q.target).parentsUntil("ul.tree","ul");return r.length+1}function o(u,v,t){var p=t?[t]:a(u).tree("getRoots");for(var s=0;s<p.length;s++){var r=h(u,p[s].target,false);for(var q=0;q<r.length;q++){a(u).tree("expandTo",r[q].target)}v--;if(v>0){for(var q=0;q<r.length;q++){o(u,v,r[q])}}}}function k(q){var p=a.extend(true,{},a.fn.tree.defaults,a(q).tree("options"));if(!p.customAttr.onlyNodeExpand){return}var r=p.onBeforeExpand;a(q).tree({onBeforeExpand:function(v){r.call(this,v);var u=a(q).tree("getParent",v.target);if(u){var t=h(q,u.target,false);for(var s=0;s<t.length;s++){if(t[s].state=="open"){a(q).tree("collapseAll",t[s].target)}}}else{a(q).tree("collapseAll")}}})}a.fn.tree.contextmenu={};a.fn.tree.contextmenu.defaultEvents={moveup:function(t,s,u){var q=a.extend(true,{},a.fn.tree.defaults,a(u).tree("options"));var r=d(u,s);if(r){var p=a(u).tree("pop",s.target);a(u).tree("insert",{before:r.target,data:p});q.customAttr.onAfterMove.call(this,r,s)}},movedown:function(t,s,u){var r=a.extend(true,{},a.fn.tree.defaults,a(u).tree("options"));var q=l(u,s);if(q){var p=a(u).tree("pop",s.target);a(u).tree("insert",{after:q.target,data:p});r.customAttr.onAfterMove.call(this,q,s)}}};a.fn.tree.defaults.customAttr={idField:null,textField:null,parentField:null,iconField:null,expandOnNodeClick:false,expandOnDblClick:false,onlyNodeExpand:false,contextMenu:{isShow:false,isMerge:true,items:[]},onAfterMove:function(q,p){}};a.fn.tree.defaults.loadFilter=function(u,x){var q=a(this).tree("options").customAttr;if(q&&q.parentField){var p=q.idField||"id",s=q.textField||"text",r=q.iconField||"icon",w=q.parentField||"pid";var y=[],z=[];for(var t=0,v=u.length;t<v;t++){z[u[t][p]]=u[t]}for(var t=0,v=u.length;t<v;t++){if(z[u[t][w]]&&u[t][p]!=u[t][w]){if(!z[u[t][w]]["children"]){z[u[t][w]]["children"]=[]}u[t]["text"]=u[t][s];u[t][r]&&(u[t]["iconCls"]=u[t][r]);z[u[t][w]]["children"].push(u[t])}else{u[t]["text"]=u[t][s];y.push(u[t])}}return y}return u};var e=a.extend({},a.fn.tree.methods);a.extend(a.fn.tree.methods,{followCustomHandle:function(p){return p.each(function(){n(this);g(this);k(this)})},getLevel:function(q,p){return f(q[0],p)},expandTo:function(q,p){return q.each(function(){if(a.type(p)=="number"){var r=p;o(this,r)}else{e.expandTo(q,p)}})}})})(jQuery);(function(c){function d(n,m){return c(n).attr("id")+"_"+m}function f(p,q,m){var o=d(p,m);var n=c("#"+o);if(n.length==0){n=c("<div>",{id:o}).menu();n.menu("appendItems",q)}return n}function k(n){var m={};c.each(n,function(){var p=this;if(p.onclick){var o=p.id||p.text;m[o]=p.onclick;delete p.onclick}if(p.submenu&&c.isArray(p.submenu)&&p.submenu.length>0){c.extend(m,k(p.submenu))}});return m}function h(n){var m=d(n,"rowContextMenu");return[{id:m+"_delete",text:"删除",iconCls:"icon-remove",onclick:c.fn.treegrid.headerContextMenu.defaultEvents.doRemove},"-",{id:m+"_reload",text:"刷新",iconCls:"icon-reload",onclick:c.fn.treegrid.headerContextMenu.defaultEvents.doReload}]}function l(q){var m=c.extend(true,{},c.fn.treegrid.defaults,c(q).treegrid("options"));var n=m.customAttr.contextMenu;if(!n.isShow){return}var r=h(q);if(n.isMerge&&c.isArray(n.items)&&n.items.length>0){c.merge(r,n.items)}if(!n.isMerge&&c.isArray(n.items)&&n.items.length>0){r=n.items}var p=k(r);var o=f(q,r,"rowContextMenu");c(q).treegrid({onContextMenu:function(t,u){t.preventDefault();c(q).treegrid("select",u[m.idField]);var s=o.menu("options");s.onClickCallback=s.onClickCallback||s.onClick;o.menu({onClick:function(w){var v=w.id||w.text;if(p[v]){p[v].call(this,w,u,q)}}}).menu("show",{left:t.pageX,top:t.pageY})}})}function e(s){var r=d(s,"headerContextMenu");var m=[{text:"显示/隐藏列",iconCls:"icon-columns",submenu:[{id:r+"_showAll",text:"全部显示",iconCls:"icon-columns",onclick:function(u,v,t){c.fn.datagrid.headerContextMenu.defaultEvents.doShowAll(t)}},{id:r+"_restore",text:"还原",iconCls:"icon-columns",onclick:function(u,v,t){c.fn.datagrid.headerContextMenu.defaultEvents.doRestore(t)}},"-"]}];var n=function(t){return t.substr(t.lastIndexOf("_")+1,t.length)};var p=[];var q=c(s).treegrid("getColumnFields");var o=c(s).treegrid("options").treeField;c.each(q,function(u,w){if(!w){return true}var v=w==o?true:false;var t=c(s).treegrid("getColumnOption",w);t._hidden=t.hidden;p.push({id:r+"_"+w,text:t.title,iconCls:t.hidden?"icon-unchecked":"icon-checked",disabled:v,onclick:function(y,x,B){var A=n(y.id);var z=c(B).treegrid("getColumnOption",A).hidden;if(!z){c.fn.datagrid.headerContextMenu.defaultEvents.doHideColumn(B,A,y)}else{c.fn.datagrid.headerContextMenu.defaultEvents.doShowColumn(B,A,y)}}})});c.merge(m[0].submenu,p);return m}function j(q){var o=c.extend(true,{},c.fn.treegrid.defaults,c(q).treegrid("options"));var s=o.customAttr.headerContextMenu;if(!s.isShow){return}var r=e(q);if(s.isMerge){c.merge(r,s.items)}if(!s.isMerge&&c.isArray(s.items)&&s.items.length>0){r=s.items}var p=k(r);var n=o.onHeaderContextMenu;var m=f(q,r,"headerContextMenu");c(q).treegrid({onHeaderContextMenu:function(u,t){u.preventDefault();m.menu({onClick:function(w){var v=w.id||w.text;if(p[v]){p[v].call(this,w,t,q)}}}).menu("show",{left:u.pageX,top:u.pageY});n.call(this,u,t)}})}function a(r){var o=c.extend(true,{},c.fn.treegrid.defaults,c(r).treegrid("options"));if(!o.customAttr.expandOnNodeClick&&!o.customAttr.expandOnDblClick){return}var m=o.treeField;var n=o.idField;if(o.customAttr.expandOnNodeClick){var q=o.onClickCell;c(r).treegrid({onClickCell:function(s,t){if(m==s){c(r).treegrid("toggle",t[n])}q.call(this,s,t)}});return}if(o.customAttr.expandOnDblClick){var p=o.onDblClickCell;c(r).treegrid({onDblClickCell:function(s,t){if(m==s){c(r).treegrid("toggle",t[n])}p.call(this,s,t)}})}}function b(r){var w=c.extend(true,{},c.fn.treegrid.defaults,c(r).treegrid("options"));if(!w.customAttr.rowediting){return}var o=function(x){return c(x).attr("id")+"_editor_buttons_panel"};var p=120;var u=function(B){var A=o(B);if(c("#"+A).length>0){return}var y=c(B).treegrid("getPanel");var z=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",y);z.css("position","relative");var x=c("<div>",{id:A}).addClass("dialog-button").appendTo(z).css({position:"absolute",display:"block","border-bottom":"1px solid #ddd","border-left":"1px solid #ddd","border-right":"1px solid #ddd",left:parseInt(y.width()/2)-p,"z-index":2013,display:"none",padding:"4px 5px"});c('<a href="javascript:void(0)">确定</a>').css("margin-left","0px").linkbutton({iconCls:"icon-ok"}).click(function(){var C=w.idField;var D=c(B).treegrid("getEditingRow");c(B).treegrid("endEdit",D[C])}).appendTo(x);c('<a href="javascript:void(0)">取消</a>').css("margin-left","6px").linkbutton({iconCls:"icon-cancel"}).click(function(){var C=w.idField;var D=c(B).treegrid("getEditingRow");c(B).treegrid("cancelEdit",D[C])}).appendTo(x)};var n=function(D,F){var y=w.idField;var E=w.finder.getTr(D,F[y],"body",2);var A=E.position();var z="#"+o(D);var x=c(D).treegrid("getPanel");var B=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",x);var C=function(){var G=E.height(),H=E.width();var J=A.top+B.scrollTop(),I=A.left;var K=11;if(H>B.width()){I=B.width()/2-p}else{I=H/2-p}if(A.top+(G*2+K)>B.height()){J=J-(G+K)}else{J=J+G}return{top:J,left:I}};c(z).css(C()).show()};var q=function(y){var x="#"+o(y);c(x).hide()};var s=w.onLoadSuccess;var v=w.onBeforeEdit;var t=w.onAfterEdit;var m=w.onCancelEdit;c(r).treegrid({onLoadSuccess:function(y,x){s.call(this,y,x);u(this)},onBeforeEdit:function(x){n(r,x);v.call(this,x)},onAfterEdit:function(y,x){q(r);t.call(this,y,x)},onCancelEdit:function(x){q(r);m.call(this,x)}})}function g(o){var n=c.extend(true,{},c.fn.treegrid.defaults,c(o).treegrid("options"));if(!n.customAttr.tooltip.enable){return}var s=function(v,u){var t={position:n.customAttr.tooltip.position,trackMouse:true,onHide:function(){c(v).tooltip("destroy")},onShow:function(){if(c.isPlainObject(u)&&u.css){c(this).tooltip("tip").css(u.css)}}};c.extend(t,c.isPlainObject(u)?u:{content:u});c(v).tooltip(t).tooltip("show")};var r=function(y,u){var x=c(y).attr("node-id");var w=c(o).treegrid("find",x);var t=function(B){var A=[];var z=c.grep(c.merge(c(o).treegrid("getColumnFields",true),c(o).treegrid("getColumnFields")),function(D,C){return c.trim(D).length>0});c.each(z,function(){var C=this;var D=c(o).treegrid("getColumnOption",C).title;A.push(D+": "+B[C])});return A.join("<br>")};var v=u?u(x,w):t(w);c(y).mouseover(function(){s(this,v)})};var m=function(t,u){t.mouseover(function(){var y=c(this).parent().attr("node-id");var w=c(o).treegrid("find",y);var z=c(this).attr("field");var x=w[z];var v=u?u(x,z,y,w):x;s(this,v)})};var q=function(){if(n.customAttr.tooltip.target=="row"){n.finder.getTr(o,"","allbody").each(function(){if(c(this).hasClass("datagrid-row")){r(this,n.customAttr.tooltip.formatter)}})}else{if(n.customAttr.tooltip.fields&&c.isArray(n.customAttr.tooltip.fields)){var t=c(o).treegrid("getPanel");var u=c(">div.datagrid-view>div.datagrid-view2>div.datagrid-body",t);c.each(n.customAttr.tooltip.fields,function(){var v=this;m(c("td[field="+v+"]",u),n.customAttr.tooltip.formatter)})}}};var p=n.onLoadSuccess;c(o).treegrid({onLoadSuccess:function(u,t){p.call(this,u,t);q()}})}c.fn.treegrid.headerContextMenu={};c.fn.treegrid.headerContextMenu.defaultEvents={doRemove:function(m,o,n){c.messager.confirm("疑问","您确定要删除已选中的行？",function(q){if(q){var p=c(n).treegrid("options").idField;var s=o[p];c(n).treegrid("remove",s)}})},doReload:function(m,o,n){c(n).treegrid("reload")}};c.fn.treegrid.defaults.customAttr={iconField:null,parentField:null,expandOnNodeClick:false,expandOnDblClick:false,headerContextMenu:{isShow:false,isMerge:true,items:[]},contextMenu:{isShow:false,isMerge:true,items:[]},rowediting:false,tooltip:{enable:false,target:"row",position:"bottom",fields:undefined,formatter:undefined}};c.fn.treegrid.defaults.loadFilter=function(o,q){var u=c(this).treegrid("options");var t=u.customAttr;if(t&&t.parentField){var m=u.idField,s=t.parentField,n=t.iconField||"icon";for(var p=0,r=o.rows.length;p<r;p++){if(o.rows[p][m]!=o.rows[p][s]){o.rows[p]["_parentId"]=o.rows[p][s]}else{delete o.rows[p][s]}o.rows[p]["iconCls"]=o.rows[p][n]}}return o};c.extend(c.fn.treegrid.methods,{followCustomHandle:function(m){return m.each(function(){j(this);l(this);a(this);b(this);g(this)})},getEditingRow:function(o){var m=o.treegrid("options");var n=[];m.finder.getTr(o[0],"","allbody").each(function(){if(c(this).hasClass("datagrid-row-editing")){var p=c(this).attr("node-id");n.push(o.treegrid("find",p))}});return n.length>0?n[0]:null}})})(jQuery);(function(a){a.extend(a.fn.validatebox.defaults.rules,{unequal:{validator:function(b,c){return b!=c},message:a.fn.validatebox.defaults.missingMessage},minLength:{validator:function(b,c){return b.length>=c[0]}},equals:{validator:function(b,c){if(/^#/.test(c)){return b==a(c).val()}else{return b==c}}}});if(a.fn.validatebox){a.fn.validatebox.defaults.rules.minLength.message="请至少输入{0}个字符。";a.fn.validatebox.defaults.rules.equals.message="字段不匹配"}})(jQuery);(function($){function getTop(w,options){var _doc;try{_doc=w.top.document;_doc.getElementsByTagName}catch(e){return w}if(options.locate=="document"||_doc.getElementsByTagName("frameset").length>0){return w}return w.top}function setWindowSize(w,options){var _top=getTop(w,options);var wHeight=$(_top).height(),wWidth=$(_top).width();if(options.locate=="top"||options.locate=="document"){if(options.height=="auto"){options.height=wHeight*0.6}if(options.width=="auto"){options.width=wWidth*0.6}}else{var locate=/^#/.test(options.locate)?options.locate:"#"+options.locate;if(options.height=="auto"){options.height=$(locate).height()*0.6}if(options.width=="auto"){options.width=$(locate).width()*0.6}}}$.extend({showWindow:function(options){options=options||{};var target;var winOpts=$.extend({},{iconCls:"icon-form",useiframe:false,locate:"top",data:undefined,width:"auto",height:"auto",cache:false,minimizable:true,maximizable:true,collapsible:true,resizable:true,onClose:function(){target.dialog("destroy")}},options);var iframe=null;if(/^url:/.test(winOpts.content)){var url=winOpts.content.substr(4,winOpts.content.length);if(winOpts.useiframe){iframe=$("<iframe>").attr("height","98%").attr("width","100%").attr("marginheight",0).attr("marginwidth",0).attr("frameborder",0);setTimeout(function(){iframe.attr("src",url)},10)}else{winOpts.href=url}delete winOpts.content}var callbackArguments={getData:function(name){return winOpts.data?winOpts.data[name]:null},close:function(){target.panel("close")}};var _top=getTop(window,winOpts);var warpHandler=function(handler){if(typeof handler=="function"){return function(){handler(callbackArguments)}}if(typeof handler=="string"&&winOpts.useiframe){return function(){iframe[0].contentWindow[handler](callbackArguments)}}if(typeof handler=="string"){return function(){eval(_top[handler])(callbackArguments)}}};setWindowSize(window,winOpts);if(winOpts.toolbar&&$.isArray(winOpts.toolbar)){$.each(winOpts.toolbar,function(i,button){button.handler=warpHandler(button.handler)})}if(winOpts.buttons&&$.isArray(winOpts.buttons)){$.each(winOpts.buttons,function(i,button){button.handler=warpHandler(button.handler)})}var onLoadCallback=winOpts.onLoad;winOpts.onLoad=function(){onLoadCallback&&onLoadCallback.call(this,callbackArguments,_top)};if(winOpts.locate=="top"||winOpts.locate=="document"){if(winOpts.useiframe&&iframe){iframe.bind("load",function(){onLoadCallback&&onLoadCallback.call(this,callbackArguments,iframe[0].contentWindow)});target=_top.$("<div>").append(iframe).dialog(winOpts)}else{target=_top.$("<div>").dialog(winOpts)}}else{var locate=/^#/.test(winOpts.locate)?winOpts.locate:"#"+winOpts.locate;target=$("<div>").appendTo(locate).dialog($.extend({},winOpts,{inline:true}))}},showModalDialog:function(options){options=options||{};var opts=$.extend({},options,{modal:true,minimizable:false,maximizable:false,resizable:false,collapsible:false});$.showWindow(opts)}})})(jQuery);